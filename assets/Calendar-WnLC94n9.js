import{j as t,a as V,b as g,c as ie}from"./index-z83d4aJt.js";import{b as d}from"./vendor-DPLMwiL-.js";import{A as Y,a as le}from"./AddressAutocomplete-DIoeDI48.js";const ce=({open:u,title:x,message:N,onConfirm:T,onCancel:S})=>u?t.jsx("div",{className:"custom-modal-overlay",children:t.jsxs("div",{className:"custom-modal",children:[t.jsx("h3",{className:"custom-modal-title",children:x}),t.jsx("div",{className:"custom-modal-message",children:N}),t.jsxs("div",{className:"custom-modal-actions",children:[t.jsx("button",{className:"custom-modal-btn confirm",onClick:T,children:"Yes, Delete"}),t.jsx("button",{className:"custom-modal-btn cancel",onClick:S,children:"Cancel"})]})]})}):null,K={"Personal Calendar":{color:"#F8C8DC",textColor:"#22314a"},"Business Calendar":{color:"#CDEAC0",textColor:"#22314a"},"Kids Sports & Events":{color:"#FDE2A7",textColor:"#22314a"},"Personal Sports & Events":{color:"#FFCFD2",textColor:"#22314a"},"Centre Com Computers":{color:"#D7C0FD",textColor:"#22314a"},Commerical:{color:"#C7D2FE",textColor:"#22314a"},"Daniel Allison":{color:"#BDE0FE",textColor:"#22314a"},"Jaki Lew":{color:"#CAF0F8",textColor:"#22314a"},"Krongold Family":{color:"#B8E0D2",textColor:"#22314a"},"Krongold Group":{color:"#FFE5B4",textColor:"#22314a"},"Office & Administration":{color:"#E3F2C1",textColor:"#22314a"},"Peter & Alla Lew":{color:"#F9E2AF",textColor:"#22314a"},"Remote Programming":{color:"#E4C1F9",textColor:"#22314a"},Residential:{color:"#F1F0FF",textColor:"#22314a"},"Rosie Lew":{color:"#FFD6E0",textColor:"#22314a"},"Stevie Lew":{color:"#FFEDC2",textColor:"#22314a"},"Supply & Demand":{color:"#D0F4DE",textColor:"#22314a"},"Training & Research":{color:"#C9E4DE",textColor:"#22314a"},"Travel Time":{color:"#EAD7BB",textColor:"#22314a"},"Website & Marketing":{color:"#E0E0E0",textColor:"#22314a"},"Precision Home Education":{color:"#CFE1F2",textColor:"#22314a"}},P=u=>K[u]||{color:"#E0E0E0",textColor:"#000"},pe=()=>{const u="Australia/Sydney",[x,N]=d.useState(!1),[T,S]=d.useState(!0),[h,F]=d.useState("monthly"),[G,f]=d.useState([]),[J,U]=d.useState([]),[M,v]=d.useState(null),[k,C]=d.useState(!1),[y,j]=d.useState(null),[c,Z]=d.useState(new Date),[s,p]=d.useState({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:"",addressMeta:null}),[O,E]=d.useState(""),[z,A]=d.useState(!1),B=J.filter(e=>`${e.firstName} ${e.lastName}`.toLowerCase().includes(O.toLowerCase()));d.useEffect(()=>{(()=>{const a=V.isAuthenticated();N(a),S(!1)})()},[]);const w=e=>{if(!e.appointmentDate)return e;const a=new Date(e.appointmentDate),o=new Intl.DateTimeFormat("en-CA",{timeZone:u,year:"numeric",month:"2-digit",day:"2-digit"}).format(a),l=new Intl.DateTimeFormat("en-AU",{timeZone:u,hour:"2-digit",minute:"2-digit",hour12:!1}).format(a);let r=l;if(e.durationMinutes){const n=new Date(a.getTime()+e.durationMinutes*6e4);r=new Intl.DateTimeFormat("en-AU",{timeZone:u,hour:"2-digit",minute:"2-digit",hour12:!1}).format(n)}return{...e,time:l,endTime:r,date:o,appointmentDate:e.appointmentDate}};d.useEffect(()=>{x&&(async()=>{v(null);try{const a=await g.getAll(),l=(Array.isArray(a)?a:a.appointments||[]).map(w);f(l)}catch(a){console.error("Error loading appointments:",a),f([]);const o=a?.status===401?"Your session has expired. Please log in again to view appointments.":a?.message||"Failed to load appointments.";v({type:"error",message:o})}try{const a=await ie.getCalendarCustomers(),o=Array.isArray(a)?a:a.customers||[];U(o)}catch(a){console.error("Error loading customers:",a),U([]),a?.status===403?v({type:"error",message:"You are logged in without admin/staff permissions. Customer list is hidden. Appointments can still be created by typing a client name, but dropdown requires admin/staff."}):a?.status===401&&v({type:"error",message:"Your session has expired. Please log in again to load customers."})}})()},[x]);const Q=async e=>{e.preventDefault(),console.log("Attempting to create appointment with data:",s);const a=W(s.time,s.endTime);if(isNaN(a)||a<15||a>480){alert("Duration must be between 15 and 480 minutes.");return}if(!s.customerId||isNaN(Number(s.customerId))||!Number.isInteger(Number(s.customerId))){alert("Please select a valid client from the dropdown.");return}const o=`${s.date}T${s.time}:00`,l=new Date(o),r={title:s.title,description:s.description||`Client: ${s.client}
Category: ${s.category}
Address: ${s.address}`,appointmentDate:l.toISOString(),durationMinutes:a,customerId:Number(s.customerId),address:s.address||"",addressPlaceId:s.addressMeta?.placeId||null,addressLat:s.addressMeta?.lat??null,addressLng:s.addressMeta?.lng??null,addressComponents:s.addressMeta?.components||null};console.log("Appointment payload:",r),Object.keys(r).forEach(n=>{console.log(`${n}:`,r[n],"type:",typeof r[n])});try{const n=await g.create(r);console.log("Appointment created successfully:",n),p({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:"",addressMeta:null}),C(!1);const i=await g.getAll(),D=(Array.isArray(i)?i:i.appointments||[]).map(w);f(D),alert("Appointment added successfully!")}catch(n){let i="Failed to add appointment. ";n.response&&n.response.data&&n.response.data.error?(typeof n.response.data.error=="string"?i+=n.response.data.error:n.response.data.error.message?i+=n.response.data.error.message:i+=JSON.stringify(n.response.data.error),n.response.data.error.details&&(i+=`
Details:`,n.response.data.error.details.forEach(m=>{i+=`
- ${m.path}: ${m.msg} (value: ${m.value})`}))):n.message&&(i+=n.message),alert(i)}},W=(e,a)=>{const[o,l]=e.split(":").map(Number),[r,n]=a.split(":").map(Number),i=o*60+l;return r*60+n-i},$=e=>{const a=_(e);j(e.id),p(a),E(a.client||""),C(!0)},X=async e=>{e.preventDefault();const a=`${s.date}T${s.time}:00`,o=new Date(a),l=W(s.time,s.endTime),r={title:s.title,description:s.description,appointmentDate:o.toISOString(),durationMinutes:l,customerId:Number(s.customerId),address:s.address||"",category:s.category||""};s.addressMeta&&(r.addressPlaceId=s.addressMeta.placeId||null,r.addressLat=s.addressMeta.lat??null,r.addressLng=s.addressMeta.lng??null,r.addressComponents=s.addressMeta.components||null);try{await g.update(y,r),p({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:"",addressMeta:null}),j(null),C(!1);const n=await g.getAll(),m=(Array.isArray(n)?n:n.appointments||[]).map(w);f(m)}catch(n){console.error("Error updating appointment:",n),alert("Failed to update appointment. Please try again.")}},[H,I]=d.useState({open:!1,id:null}),_=e=>{const a=e.client||(e.customer?`${e.customer.firstName||""} ${e.customer.lastName||""}`.trim():"")||"";return{title:e.title||"",date:e.date||"",time:e.time||"",endTime:e.endTime||"",client:a,customerId:e.customerId||e.customer?.id||"",description:e.description||"",category:e.category||"",address:e.address||"",addressMeta:null,id:e.id,appointmentDate:e.appointmentDate}},ee=async e=>{I({open:!0,id:e})},te=async()=>{const e=H.id;I({open:!1,id:null});try{await g.delete(e);const a=await g.getAll(),l=(Array.isArray(a)?a:a.appointments||[]).map(w);f(l)}catch(a){console.error("Error deleting appointment:",a),alert("Failed to delete appointment. Please try again.")}},L=e=>{const a=new Intl.DateTimeFormat("en-CA",{timeZone:u,year:"numeric",month:"2-digit",day:"2-digit"}).format(e);return G.filter(o=>o.date===a)},ae=()=>{const e=Number(new Intl.DateTimeFormat("en-US",{timeZone:u,year:"numeric"}).format(c)),a=Number(new Intl.DateTimeFormat("en-US",{timeZone:u,month:"numeric"}).format(c))-1,o=new Date(e,a,1),l=o.getDay();let r=new Date(o);r.setDate(r.getDate()-l);const n=[];for(let i=0;i<42;i++){const m=new Date(r);m.setDate(r.getDate()+i),n.push(m)}return n},ne=()=>{const e=c.getDay(),a=new Date(c);a.setDate(c.getDate()-e);const o=[];for(let l=0;l<7;l++){const r=new Date(a);r.setDate(a.getDate()+l),o.push(r)}return o},R=e=>{const a=new Date(c);switch(h){case"monthly":a.setMonth(c.getMonth()+e);break;case"weekly":a.setDate(c.getDate()+e*7);break;case"daily":a.setDate(c.getDate()+e);break}Z(a)},b=()=>{const e=[];for(let a=0;a<24;a++)for(let o=0;o<60;o+=15){const l=`${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;e.push(l)}return e};return T?t.jsx("div",{className:"calendar-container",style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("h2",{children:"Loading Calendar..."})}):x?t.jsxs("div",{className:"calendar-container",children:[t.jsxs("div",{className:"calendar-header",children:[t.jsx("h1",{className:"calendar-title",children:"Calendar Management"}),t.jsx("button",{className:"calendar-logout-btn",onClick:()=>{V.logout(),N(!1),window.location.href="/"},children:"Logout"})]}),M&&t.jsx("div",{className:`calendar-feedback ${M.type==="error"?"error":""}`,children:M.message}),t.jsx("div",{className:"calendar-dashboard",children:t.jsxs("div",{className:"calendar-card",children:[t.jsx("h3",{children:"Appointment Management"}),t.jsx("p",{children:"View and manage appointments, clients, and schedules."}),t.jsx("button",{className:"calendar-btn-main",onClick:()=>{C(!k),j(null),p({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:"",addressMeta:null})},children:k?"Cancel":"Add New Appointment"})]})}),k&&t.jsxs("div",{className:"calendar-section",children:[t.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem"},children:y?"Edit Appointment":"Add New Appointment"}),t.jsxs("form",{className:"calendar-form",onSubmit:e=>{if(e.preventDefault(),!s.customerId){alert("Please select a valid client from the dropdown.");return}(y?X:Q)(e)},noValidate:!0,children:[t.jsx("input",{type:"text",placeholder:"Appointment Title",value:s.title,onChange:e=>p({...s,title:e.target.value}),required:!0,className:"calendar-input"}),t.jsxs("div",{className:"calendar-client-select",children:[t.jsx("input",{type:"text",placeholder:"Select Client",value:O||s.client,onChange:e=>{E(e.target.value),A(!0),p({...s,client:e.target.value})},onBlur:()=>{setTimeout(()=>A(!1),200)},onFocus:()=>A(!0),autoComplete:"off",required:!0,className:"calendar-input"}),z&&B.length>0&&t.jsx("div",{className:"calendar-client-dropdown",children:B.map(e=>t.jsxs("div",{className:"calendar-client-option",onClick:()=>{p({...s,client:`${e.firstName} ${e.lastName}`,customerId:e.id}),E(`${e.firstName} ${e.lastName}`),A(!1)},children:[e.firstName," ",e.lastName," ",e.company?`(${e.company})`:""]},e.id))})]}),t.jsx("input",{type:"date",value:s.date,onChange:e=>p({...s,date:e.target.value}),required:!0,className:"calendar-input"}),t.jsx(Y,{label:"Start Time",value:s.time,onChange:e=>p({...s,time:e})}),t.jsx(Y,{label:"End Time",value:s.endTime,onChange:e=>p({...s,endTime:e})}),t.jsxs("select",{value:s.category,onChange:e=>p({...s,category:e.target.value}),required:!0,className:"calendar-select",children:[t.jsx("option",{value:"",children:"Select a Category"}),Object.keys(K).map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx(le,{label:"Address/Location",value:s.address,onChange:(e,a)=>{p({...s,address:e,addressMeta:a})},placeholder:"Start typing an Australian address…",showTip:!1}),t.jsx("textarea",{placeholder:"Description",value:s.description,onChange:e=>p({...s,description:e.target.value}),className:"calendar-textarea"}),t.jsxs("div",{className:"calendar-form-actions",children:[t.jsx("button",{className:"calendar-btn-main",type:"submit",children:y?"Update Appointment":"Add Appointment"}),t.jsx("button",{className:"calendar-btn-secondary",type:"button",onClick:()=>{C(!1),j(null)},children:"Cancel"}),y&&t.jsx("button",{className:"calendar-btn-delete",type:"button",onClick:()=>ee(y),children:"Delete"})]})]})]}),t.jsxs("div",{className:"calendar-section",children:[t.jsxs("div",{className:"calendar-nav-header",children:[t.jsx("button",{onClick:()=>R(-1),className:"calendar-nav-btn",children:"‹ Previous"}),t.jsxs("h3",{className:"calendar-nav-title",children:[h==="monthly"&&new Intl.DateTimeFormat("en-AU",{timeZone:u,month:"long",year:"numeric"}).format(c),h==="weekly"&&`Week of ${new Intl.DateTimeFormat("en-AU",{timeZone:u,month:"short",day:"numeric",year:"numeric"}).format(c)}`,h==="daily"&&new Intl.DateTimeFormat("en-AU",{timeZone:u,weekday:"long",month:"long",day:"numeric",year:"numeric"}).format(c)]}),t.jsx("button",{onClick:()=>R(1),className:"calendar-nav-btn",children:"Next ›"}),t.jsxs("div",{className:"calendar-view-switcher",children:[t.jsx("button",{className:`calendar-view-btn${h==="monthly"?" active":""}`,onClick:()=>F("monthly"),type:"button",children:"Monthly"}),t.jsx("button",{className:`calendar-view-btn${h==="weekly"?" active":""}`,onClick:()=>F("weekly"),type:"button",children:"Weekly"}),t.jsx("button",{className:`calendar-view-btn${h==="daily"?" active":""}`,onClick:()=>F("daily"),type:"button",children:"Daily"})]})]}),h==="monthly"&&t.jsx("div",{className:"calendar-monthly-grid",children:ae().map((e,a)=>{const o=L(e),l=e.getMonth()===c.getMonth(),r=e.toDateString()===new Date().toDateString();return t.jsxs("div",{className:`calendar-day ${l?"":"calendar-day-muted"} ${r?"calendar-day-today":""}`,children:[t.jsx("div",{className:"calendar-day-date",children:e.getDate()}),o.filter(n=>{const i=n.time&&n.endTime&&String(n.time).trim()&&String(n.endTime).trim();return console.log("Appointment filter check:",n.id,"hasTime:",i,"time:",n.time,"endTime:",n.endTime),i}).map(n=>{const i=P(n.category);return t.jsxs("div",{className:"calendar-appointment",style:{backgroundColor:i.color,color:i.textColor},onClick:()=>{$(n)},children:[t.jsxs("div",{className:"calendar-appointment-time",children:[n.time," - ",n.endTime]}),t.jsx("div",{className:"calendar-appointment-title",children:n.title})]},n.id)})]},a)})}),h==="weekly"&&t.jsxs("div",{className:"calendar-weekly-grid",children:[t.jsxs("div",{className:"calendar-time-slots",children:[t.jsx("div",{className:"calendar-time-slot-header"}),b().map((e,a)=>t.jsx("div",{className:"calendar-time-slot",children:a%4===0?e:""},e))]}),t.jsx("div",{className:"calendar-days-grid",children:ne().map((e,a)=>{const o=L(e),l=e.toDateString()===new Date().toDateString();return t.jsxs("div",{className:`calendar-day ${l?"calendar-day-today":""}`,children:[t.jsx("div",{className:"calendar-day-header",children:e.toLocaleDateString("en-US",{weekday:"short",month:"numeric",day:"numeric"})}),t.jsxs("div",{className:"calendar-day-body",children:[b().map((r,n)=>t.jsx("div",{className:"calendar-time-slot"},r)),o.filter(r=>{const n=r.time&&r.endTime&&String(r.time).trim()&&String(r.endTime).trim();return console.log("Weekly view appointment filter:",r.id,"hasTime:",n,"time:",r.time,"endTime:",r.endTime),n}).map(r=>{const n=P(r.category),[i,m]=r.time.split(":").map(Number),[D,se]=r.endTime.split(":").map(Number),q=i*60+m,re=D*60+se,oe=Math.max(30,re-q);return t.jsxs("div",{className:"calendar-appointment",style:{top:`${q}px`,height:`${oe}px`,backgroundColor:n.color,color:n.textColor},onClick:()=>{$(r)},children:[t.jsxs("div",{className:"calendar-appointment-time",children:[r.time," - ",r.endTime]}),t.jsx("div",{className:"calendar-appointment-title",children:r.title})]},r.id)})]})]},a)})})]}),h==="daily"&&t.jsxs("div",{className:"calendar-daily-grid",children:[t.jsxs("div",{className:"calendar-time-slots",children:[t.jsx("div",{className:"calendar-time-slot-header"}),b().map((e,a)=>t.jsx("div",{className:"calendar-time-slot",children:a%4===0?e:""},e))]}),t.jsxs("div",{className:"calendar-single-day",children:[t.jsx("div",{className:"calendar-day-header",children:c.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),t.jsxs("div",{className:"calendar-day-body",children:[b().map((e,a)=>t.jsx("div",{className:"calendar-time-slot"},e)),L(c).filter(e=>{const a=e.time&&e.endTime&&String(e.time).trim()&&String(e.endTime).trim();return console.log("Daily view appointment filter:",e.id,"hasTime:",a,"time:",e.time,"endTime:",e.endTime),a}).map(e=>{const a=P(e.category),[o,l]=e.time.split(":").map(Number),[r,n]=e.endTime.split(":").map(Number),i=o*60+l,m=r*60+n,D=Math.max(30,m-i);return t.jsxs("div",{className:"calendar-appointment",style:{top:`${i}px`,height:`${D}px`,backgroundColor:a.color,color:a.textColor},onClick:()=>{$(e)},children:[t.jsxs("div",{className:"calendar-appointment-time",children:[e.time," - ",e.endTime]}),t.jsx("div",{className:"calendar-appointment-title",children:e.title}),t.jsx("div",{className:"calendar-appointment-category",children:e.category})]},e.id)})]})]})]})]}),t.jsx(ce,{open:H.open,title:"Delete Appointment",message:"Are you sure you want to delete this appointment? This action cannot be undone.",onConfirm:te,onCancel:()=>I({open:!1,id:null})})]}):t.jsx("div",{className:"calendar-container",children:t.jsxs("div",{className:"calendar-card",style:{maxWidth:500,margin:"3rem auto",textAlign:"center"},children:[t.jsx("h1",{className:"calendar-title",children:"🔒 Calendar Access Required"}),t.jsx("p",{style:{color:"#666",marginBottom:24},children:"Please log in to access the calendar system."}),t.jsx("a",{href:"/login",className:"calendar-btn-main",children:"Go to Login Page"})]})})};export{pe as default};
