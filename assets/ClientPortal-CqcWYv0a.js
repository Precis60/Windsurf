import{a as q,j as e,s as p,b as m}from"./index-Cfo6D94r.js";import{b as o}from"./vendor-DPLMwiL-.js";import{A as b,a as k}from"./AddressAutocomplete-B59vfMYk.js";const C=()=>{const[h,x]=o.useState([]),[y,g]=o.useState([]),[f,j]=o.useState(!0),[s,l]=o.useState({title:"",description:"",date:"",time:"",endTime:"",address:"",addressMeta:null}),[a,d]=o.useState({subject:"",description:"",priority:"medium"}),v=(t,r)=>{const[i,c]=t.split(":").map(Number),[u,n]=r.split(":").map(Number);return u*60+n-(i*60+c)};o.useEffect(()=>{(async()=>{j(!0);try{const r=await p.getTickets();x(Array.isArray(r)?r:r.tickets||[]);const i=await m.getAll();g(Array.isArray(i)?i:i.requests||[])}catch(r){console.error("Client portal load error:",r)}finally{j(!1)}})()},[]);const S=async t=>{t.preventDefault();const r=v(s.time,s.endTime);if(isNaN(r)||r<15||r>480){alert("Duration must be between 15 and 480 minutes.");return}const i=`${s.date}T${s.time}:00`,c=new Date(i),u={title:s.title,description:s.description,requestedDate:c.toISOString(),durationMinutes:r,address:s.address||"",addressPlaceId:s.addressMeta?.placeId||null,addressLat:s.addressMeta?.lat??null,addressLng:s.addressMeta?.lng??null,addressComponents:s.addressMeta?.components||null};try{await m.create(u),alert("Your appointment request has been submitted. We will review and confirm."),l({title:"",description:"",date:"",time:"",endTime:"",address:"",addressMeta:null});const n=await m.getAll();g(Array.isArray(n)?n:n.requests||[])}catch(n){console.error("Submit request error:",n),alert(n?.message||"Failed to submit request")}},T=async t=>{if(t.preventDefault(),!a.subject.trim()||!a.description.trim()){alert("Please fill in both subject and description.");return}const r={subject:a.subject.trim(),description:a.description.trim(),priority:a.priority,status:"open"};try{await p.createTicket(r),alert("Your support ticket has been submitted successfully. We will respond soon."),d({subject:"",description:"",priority:"medium"});const i=await p.getTickets();x(Array.isArray(i)?i:i.tickets||[])}catch(i){console.error("Submit support ticket error:",i),alert(i?.message||"Failed to submit support ticket")}};return q.isAuthenticated()?e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:1200,margin:"0 auto"},children:[e.jsx("h1",{style:{color:"#22314a"},children:"Client Portal"}),e.jsx("p",{children:"View your support tickets, submit new support requests, and request tentative appointments for site visits."}),f?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{color:"#22314a"},children:"Your Support Tickets"}),h.length===0?e.jsx("div",{style:{background:"#fff",padding:20,border:"1px solid #e1e5e9",borderRadius:8},children:"No tickets yet."}):e.jsx("div",{style:{display:"grid",gap:"12px"},children:h.map(t=>e.jsxs("div",{style:{background:"#fff",padding:16,border:"1px solid #e1e5e9",borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("strong",{children:["#",t.id," - ",t.subject]}),e.jsx("span",{style:{textTransform:"capitalize"},children:t.status?.replace("_"," ")})]}),e.jsxs("div",{style:{color:"#666",fontSize:14},children:[t.description?.slice(0,120),"..."]})]},t.id))}),e.jsx("h2",{style:{color:"#22314a",marginTop:"2rem"},children:"Your Appointment Requests"}),y.length===0?e.jsx("div",{style:{background:"#fff",padding:20,border:"1px solid #e1e5e9",borderRadius:8},children:"No appointment requests yet."}):e.jsx("div",{style:{display:"grid",gap:"12px"},children:y.map(t=>e.jsxs("div",{style:{background:"#fff",padding:16,border:"1px solid #e1e5e9",borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("strong",{children:t.title}),e.jsx("span",{style:{textTransform:"capitalize"},children:t.status})]}),e.jsx("div",{style:{color:"#666",fontSize:14},children:new Date(t.requestedDate).toLocaleString("en-AU")}),t.address&&e.jsxs("div",{style:{color:"#666",fontSize:13},children:["📍 ",t.address]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{style:{color:"#22314a"},children:"Submit Support Ticket"}),e.jsxs("form",{onSubmit:T,style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef"},children:[e.jsx("input",{className:"calendar-input",type:"text",placeholder:"Subject",value:a.subject,onChange:t=>d({...a,subject:t.target.value}),required:!0,style:{marginBottom:"1rem"}}),e.jsx("textarea",{className:"calendar-textarea",placeholder:"Describe your issue or question in detail...",value:a.description,onChange:t=>d({...a,description:t.target.value}),required:!0,rows:6,style:{marginBottom:"1rem"}}),e.jsxs("select",{className:"calendar-select",value:a.priority,onChange:t=>d({...a,priority:t.target.value}),style:{marginBottom:"1rem"},children:[e.jsx("option",{value:"low",children:"Low Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"urgent",children:"Urgent"})]}),e.jsx("button",{className:"calendar-btn-main",type:"submit",style:{width:"100%"},children:"Submit Support Ticket"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{style:{color:"#22314a"},children:"Request Tentative Appointment"}),e.jsxs("form",{onSubmit:S,children:[e.jsx("input",{className:"calendar-input",type:"text",placeholder:"Appointment Title",value:s.title,onChange:t=>l({...s,title:t.target.value}),required:!0}),e.jsx("textarea",{className:"calendar-textarea",placeholder:"Description",value:s.description,onChange:t=>l({...s,description:t.target.value})}),e.jsx("input",{className:"calendar-input",type:"date",value:s.date,onChange:t=>l({...s,date:t.target.value}),required:!0}),e.jsx(b,{label:"Start Time",value:s.time,onChange:t=>l({...s,time:t})}),e.jsx(b,{label:"End Time",value:s.endTime,onChange:t=>l({...s,endTime:t})}),e.jsx(k,{label:"Address/Location",value:s.address,onChange:(t,r)=>l({...s,address:t,addressMeta:r}),placeholder:"Start typing an Australian address…",showTip:!1}),e.jsx("button",{className:"calendar-btn-main",type:"submit",style:{marginTop:12},children:"Submit Request"})]})]})]})]}):e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:700,margin:"0 auto"},children:[e.jsx("h2",{children:"🔒 Login required"}),e.jsx("p",{children:"Please log in to access your client portal."}),e.jsx("a",{href:"/login",className:"calendar-btn-main",children:"Go to Login"})]})};export{C as default};
