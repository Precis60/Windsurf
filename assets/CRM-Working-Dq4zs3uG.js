import{j as e,a as A,c as g}from"./index-UbSjZYka.js";import{b as a}from"./vendor-DR4o8xae.js";const L=()=>{const[C,S]=a.useState(!1),[k,R]=a.useState(!0),[v,x]=a.useState([]),[w,c]=a.useState(!1),[h,N]=a.useState(!1),[B,y]=a.useState(null),[f,m]=a.useState(!1),[p,d]=a.useState({type:"",text:""}),[r,o]=a.useState({companyName:"",contactName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""});a.useEffect(()=>{(()=>{const s=A.isAuthenticated();S(s),R(!1)})()},[]),a.useEffect(()=>{C&&(async()=>{try{const s=await g.getAll(),i=Array.isArray(s)?s:s.customers||[];x(i)}catch(s){console.error("Error loading customers:",s),x([])}})()},[C]);const z=async()=>{console.log("Saving customer to online database..."),m(!0),d({type:"",text:""});try{if(!r.contactName?.trim()){d({type:"error",text:"Contact Name is required"}),m(!1);return}if(!r.email?.trim()){d({type:"error",text:"Email is required"}),m(!1);return}const t=r.contactName.trim().split(" "),s=t[0]||"Customer",i=t.slice(1).join(" ")||"",u={firstName:s,lastName:i,email:r.email.trim(),phone:r.phone?.trim()||null,company:r.companyName?.trim()||null,address:[r.address,r.city,r.state,r.zipCode].filter(Boolean).join(", ")||null};console.log("Sending customer data to online database:",u);const j=await g.create(u);console.log("✅ Customer successfully saved to online database:",j);const n=await g.getAll(),b=Array.isArray(n)?n:n.customers||[];x(b),o({companyName:"",contactName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""}),c(!1),d({type:"success",text:"✅ Customer saved to online database successfully!"})}catch(t){console.error("❌ Error saving to online database:",t);let s="❌ Failed to save to online database: ";t.message.includes("Authentication required")||t.message.includes("Session expired")?(s+="Please log in again.",setTimeout(()=>window.location.href="/login",1e3)):t.message.includes("already exists")?s+="Customer with this email already exists.":s+=t.message,d({type:"error",text:s})}finally{m(!1)}},E=t=>{console.log("Editing customer:",t);let s="",i="",u="",j="";if(t.address){const n=t.address.split(", ");if(n.length>=1&&(s=n[0]||""),n.length>=2&&(i=n[1]||""),n.length>=3){const b=n[2].split(" ");u=b[0]||"",j=b[1]||""}}o({companyName:t.company||"",contactName:`${t.firstName||""} ${t.lastName||""}`.trim(),email:t.email||"",phone:t.phone||"",address:s,city:i,state:u,zipCode:j,projectType:t.projectType||"",notes:t.notes||""}),y(t.id),c(!0)},T=async t=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await g.delete(t);const s=await g.getAll(),i=Array.isArray(s)?s:s.customers||[];x(i),alert("Customer deleted from online database successfully!")}catch(s){console.error("Error deleting customer from online database:",s),alert("Failed to delete customer from online database: "+s.message)}},l={background:"#22314a",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"4px",cursor:"pointer",margin:"0 0.5rem"};return k?e.jsx("div",{className:"page-content",style:{padding:"2rem",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:e.jsxs("div",{style:{textAlign:"center",color:"#666"},children:[e.jsx("h2",{children:"Loading CRM..."}),e.jsx("p",{children:"Please wait while we load your customer data from the online database."})]})}):C?e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{color:"#22314a",margin:0},children:"Customer Relationship Management"}),e.jsx("p",{style:{margin:"0.5rem 0",color:"#666",fontSize:"0.9rem"},children:"💾 All data is saved to your secure online database across multiple devices"})]}),e.jsx("button",{onClick:()=>{A.logout(),S(!1),window.location.href="/"},style:{...l,background:"#dc3545"},children:"Logout"})]}),e.jsx("p",{style:{marginBottom:"2rem",fontSize:"1.1rem"},children:"Manage customer relationships and track project progress."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"2rem"},children:[e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef"},children:[e.jsx("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:"Customer Database"}),e.jsx("p",{children:"View and manage customer information, contact details, and project history."}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginTop:"1rem"},children:[e.jsx("button",{onClick:()=>{N(!h),c(!1),y(null)},style:{...l,width:"100%",padding:"0.5rem 1rem",fontSize:"0.9rem"},children:h?"Hide Customers":"View Customers"}),e.jsx("button",{onClick:()=>{console.log("Add Customer button clicked"),c(!0),N(!1),y(null),d({type:"",text:""}),o({companyName:"",contactName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""})},style:{...l,background:"#28a745",width:"100%",padding:"0.5rem 1rem",fontSize:"0.9rem"},children:"Add Customer"})]})]}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef"},children:[e.jsx("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:"Active Projects"}),e.jsxs("ul",{style:{listStyle:"none",padding:0},children:[e.jsx("li",{style:{padding:"0.5rem 0",borderBottom:"1px solid #dee2e6"},children:"Office Building Wiring - 75% Complete"}),e.jsx("li",{style:{padding:"0.5rem 0",borderBottom:"1px solid #dee2e6"},children:"Factory Automation - 40% Complete"}),e.jsx("li",{style:{padding:"0.5rem 0"},children:"Warehouse Network - Planning Phase"})]})]}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef"},children:[e.jsx("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:"Recent Activity"}),e.jsxs("ul",{style:{listStyle:"none",padding:0},children:[e.jsx("li",{style:{padding:"0.5rem 0",borderBottom:"1px solid #dee2e6"},children:"New quote sent to ABC Corp"}),e.jsx("li",{style:{padding:"0.5rem 0",borderBottom:"1px solid #dee2e6"},children:"Project milestone reached"}),e.jsx("li",{style:{padding:"0.5rem 0"},children:"Customer feedback received"})]})]})]}),(w||h)&&e.jsxs("div",{style:{marginTop:"3rem"},children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem"},children:"👥 Customer Management"}),w&&e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef",marginBottom:"2rem"},children:[e.jsxs("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:[B?"Edit Customer":"Add New Customer",e.jsx("span",{style:{fontSize:"0.8rem",color:"#666",marginLeft:"1rem"},children:"💾 Saves to online database"})]}),p.text&&e.jsx("div",{role:"alert",style:{marginBottom:"0.75rem",padding:"0.5rem 0.75rem",borderRadius:6,border:`1px solid ${p.type==="error"?"#f5c2c7":"#badbcc"}`,background:p.type==="error"?"#f8d7da":"#d1e7dd",color:p.type==="error"?"#842029":"#0f5132"},children:p.text}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[e.jsx("input",{type:"text",placeholder:"Company Name",value:r.companyName,onChange:t=>o({...r,companyName:t.target.value}),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"text",placeholder:"Contact Name *",value:r.contactName,onChange:t=>o({...r,contactName:t.target.value}),required:!0,style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"email",placeholder:"Email Address *",value:r.email,onChange:t=>o({...r,email:t.target.value}),required:!0,style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"tel",placeholder:"Phone Number",value:r.phone,onChange:t=>o({...r,phone:t.target.value}),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"text",placeholder:"Street Address",value:r.address,onChange:t=>o({...r,address:t.target.value}),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"text",placeholder:"City",value:r.city,onChange:t=>o({...r,city:t.target.value}),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"text",placeholder:"State",value:r.state,onChange:t=>o({...r,state:t.target.value}),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"text",placeholder:"ZIP Code",value:r.zipCode,onChange:t=>o({...r,zipCode:t.target.value}),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsxs("select",{value:r.projectType,onChange:t=>o({...r,projectType:t.target.value}),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},children:[e.jsx("option",{value:"",children:"Select Project Type"}),e.jsx("option",{value:"Network Infrastructure",children:"Network Infrastructure"}),e.jsx("option",{value:"Cable Installation",children:"Cable Installation"}),e.jsx("option",{value:"Equipment Setup",children:"Equipment Setup"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"}),e.jsx("option",{value:"Consultation",children:"Consultation"}),e.jsx("option",{value:"System Integration",children:"System Integration"}),e.jsx("option",{value:"Upgrade",children:"Upgrade"}),e.jsx("option",{value:"Emergency Service",children:"Emergency Service"})]})]}),e.jsx("textarea",{placeholder:"Notes (optional)",value:r.notes,onChange:t=>o({...r,notes:t.target.value}),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc",minHeight:"80px",marginBottom:"1rem"}}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e.jsx("button",{type:"button",style:{...l,background:f?"#6c757d":"#007bff",cursor:f?"not-allowed":"pointer"},disabled:f,onClick:z,children:f?"💾 Saving to Database...":"💾 Save to Online Database"}),e.jsx("button",{type:"button",onClick:()=>{c(!1),y(null),d({type:"",text:""}),m(!1),o({companyName:"",contactName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""})},style:{...l,background:"#6c757d"},children:"Cancel"})]})]}),h&&e.jsxs("div",{children:[e.jsxs("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:["Customer Database (",v.length," customers)"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"1rem"},children:v.length===0?e.jsx("div",{style:{background:"#f8f9fa",padding:"2rem",borderRadius:"8px",border:"1px solid #e9ecef",textAlign:"center",color:"#666"},children:e.jsx("p",{children:'No customers added yet. Click "Add Customer" to get started.'})}):v.map(t=>e.jsxs("div",{style:{background:"#fff",padding:"1.5rem",borderRadius:"8px",border:"1px solid #dee2e6",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[e.jsxs("h4",{style:{color:"#22314a",margin:0,fontSize:"1.2rem"},children:[t.firstName," ",t.lastName]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>E(t),style:{...l,padding:"0.25rem 0.5rem",fontSize:"0.8rem",background:"#28a745"},children:"Edit"}),e.jsx("button",{onClick:()=>T(t.id),style:{...l,padding:"0.25rem 0.5rem",fontSize:"0.8rem",background:"#dc3545"},children:"Delete"})]})]}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Company:"})," ",t.company]}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${t.email}`,style:{color:"#007bff",textDecoration:"none",marginLeft:"0.5rem"},children:t.email})]}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Phone:"}),e.jsx("a",{href:`tel:${t.phone}`,style:{color:"#007bff",textDecoration:"none",marginLeft:"0.5rem"},children:t.phone})]}),t.address&&e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Address:"})," ",t.address]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"1rem"},children:["💾 Saved to online database: ",new Date(t.createdAt).toLocaleDateString()]})]},t.id))})]})]})]}):e.jsx("div",{className:"page-content",style:{padding:"2rem",maxWidth:"600px",margin:"0 auto"},children:e.jsxs("div",{style:{background:"#f8f9fa",padding:"2rem",borderRadius:"8px",border:"1px solid #e9ecef",textAlign:"center"},children:[e.jsx("h1",{style:{color:"#22314a",marginBottom:"1rem"},children:"🔒 CRM Access Required"}),e.jsx("p",{style:{marginBottom:"2rem",fontSize:"1.1rem",color:"#666"},children:"Please log in to access the secure customer relationship management system."}),e.jsx("div",{style:{background:"#e8f5e8",border:"1px solid #4caf50",borderRadius:"8px",padding:"20px",marginBottom:"20px"},children:e.jsxs("p",{style:{margin:0,color:"#2e7d32",fontSize:"14px"},children:["🔐 ",e.jsx("strong",{children:"Secure Access:"})," This CRM contains sensitive customer information and requires authentication."]})}),e.jsx("a",{href:"/login",style:{background:"#22314a",color:"white",padding:"12px 24px",borderRadius:"8px",textDecoration:"none",fontSize:"16px",fontWeight:"500",display:"inline-block"},children:"Go to Login Page"})]})})};export{L as default};
