import{a as k,j as e,s as p,b as u}from"./index-Iw8oq0bs.js";import{b as d}from"./vendor-DPLMwiL-.js";import{A as f,a as T}from"./AddressAutocomplete-Z6qoGKdO.js";const B=()=>{const[x,g]=d.useState([]),[h,b]=d.useState([]),[j,y]=d.useState(!0),[r,n]=d.useState({title:"",description:"",date:"",time:"",endTime:"",address:"",addressMeta:null}),[a,l]=d.useState({subject:"",description:"",priority:"medium"}),v=(t,s)=>{const[i,c]=t.split(":").map(Number),[m,o]=s.split(":").map(Number);return m*60+o-(i*60+c)};d.useEffect(()=>{(async()=>{y(!0);try{const s=await p.getTickets();g(Array.isArray(s)?s:s.tickets||[]);const i=await u.getAll();b(Array.isArray(i)?i:i.requests||[])}catch(s){console.error("Client portal load error:",s)}finally{y(!1)}})()},[]);const S=async t=>{t.preventDefault();const s=v(r.time,r.endTime);if(isNaN(s)||s<15||s>480){alert("Duration must be between 15 and 480 minutes.");return}const i=`${r.date}T${r.time}:00`,c=new Date(i),m={title:r.title,description:r.description,requestedDate:c.toISOString(),durationMinutes:s,address:r.address||"",addressPlaceId:r.addressMeta?.placeId||null,addressLat:r.addressMeta?.lat??null,addressLng:r.addressMeta?.lng??null,addressComponents:r.addressMeta?.components||null};try{await u.create(m),alert("Your appointment request has been submitted. We will review and confirm."),n({title:"",description:"",date:"",time:"",endTime:"",address:"",addressMeta:null});const o=await u.getAll();b(Array.isArray(o)?o:o.requests||[])}catch(o){console.error("Submit request error:",o),alert(o?.message||"Failed to submit request")}},w=async t=>{if(t.preventDefault(),!a.subject.trim()||!a.description.trim()){alert("Please fill in both subject and description.");return}const s={subject:a.subject.trim(),description:a.description.trim(),priority:a.priority,status:"open"};try{await p.createTicket(s),alert("Your support ticket has been submitted successfully. We will respond soon."),l({subject:"",description:"",priority:"medium"});const i=await p.getTickets();g(Array.isArray(i)?i:i.tickets||[])}catch(i){console.error("Submit support ticket error:",i),alert(i?.message||"Failed to submit support ticket")}};return k.isAuthenticated()?e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:"1400px",margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"3rem"},children:[e.jsx("h1",{style:{color:"#22314a",fontSize:"2.5rem",marginBottom:"0.5rem"},children:"Client Portal"}),e.jsx("p",{style:{color:"#666",fontSize:"1.1rem",maxWidth:"600px",margin:"0 auto"},children:"View your support tickets, submit new support requests, and request tentative appointments for site visits."})]}),j?e.jsx("div",{style:{textAlign:"center",padding:"3rem",fontSize:"1.2rem",color:"#666"},children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(500px, 1fr))",gap:"2rem",marginBottom:"3rem"},children:[e.jsxs("div",{style:{background:"#f8f9fa",padding:"2rem",borderRadius:"12px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem",fontSize:"1.5rem"},children:"üéß Submit Support Ticket"}),e.jsxs("form",{onSubmit:w,children:[e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("input",{className:"calendar-input",type:"text",placeholder:"Subject",value:a.subject,onChange:t=>l({...a,subject:t.target.value}),required:!0,style:{width:"100%",boxSizing:"border-box"}})}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("textarea",{className:"calendar-textarea",placeholder:"Describe your issue or question in detail...",value:a.description,onChange:t=>l({...a,description:t.target.value}),required:!0,rows:5,style:{width:"100%",boxSizing:"border-box",resize:"vertical"}})}),e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsxs("select",{className:"calendar-select",value:a.priority,onChange:t=>l({...a,priority:t.target.value}),style:{width:"100%",boxSizing:"border-box"},children:[e.jsx("option",{value:"low",children:"Low Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})}),e.jsx("button",{className:"calendar-btn-main",type:"submit",style:{width:"100%"},children:"Submit Support Ticket"})]})]}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"2rem",borderRadius:"12px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem",fontSize:"1.5rem"},children:"üìÖ Request Tentative Appointment"}),e.jsxs("form",{onSubmit:S,children:[e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("input",{className:"calendar-input",type:"text",placeholder:"Appointment Title",value:r.title,onChange:t=>n({...r,title:t.target.value}),required:!0,style:{width:"100%",boxSizing:"border-box"}})}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("textarea",{className:"calendar-textarea",placeholder:"Description",value:r.description,onChange:t=>n({...r,description:t.target.value}),rows:3,style:{width:"100%",boxSizing:"border-box",resize:"vertical"}})}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("input",{className:"calendar-input",type:"date",value:r.date,onChange:t=>n({...r,date:t.target.value}),required:!0,style:{width:"100%",boxSizing:"border-box"}})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem",overflow:"hidden"},children:[e.jsx("div",{style:{overflow:"hidden"},children:e.jsx(f,{label:"Start Time",value:r.time,onChange:t=>n({...r,time:t}),compact:!0})}),e.jsx("div",{style:{overflow:"hidden"},children:e.jsx(f,{label:"End Time",value:r.endTime,onChange:t=>n({...r,endTime:t}),compact:!0})})]}),e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsx(T,{label:"Address/Location",value:r.address,onChange:(t,s)=>n({...r,address:t,addressMeta:s}),placeholder:"Start typing an Australian address‚Ä¶",showTip:!1})}),e.jsx("button",{className:"calendar-btn-main",type:"submit",style:{width:"100%"},children:"Submit Request"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(500px, 1fr))",gap:"2rem"},children:[e.jsxs("div",{style:{background:"#fff",padding:"2rem",borderRadius:"12px",border:"1px solid #e1e5e9",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem",fontSize:"1.5rem"},children:"üé´ Your Support Tickets"}),x.length===0?e.jsx("div",{style:{background:"#f8f9fa",padding:"2rem",border:"1px solid #e1e5e9",borderRadius:"8px",textAlign:"center",color:"#666"},children:"No support tickets yet."}):e.jsx("div",{style:{display:"grid",gap:"1rem"},children:x.map(t=>e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",border:"1px solid #e1e5e9",borderRadius:"8px",transition:"box-shadow 0.2s"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[e.jsxs("strong",{style:{color:"#22314a",fontSize:"1rem"},children:["#",t.id," - ",t.subject]}),e.jsx("span",{style:{textTransform:"capitalize",background:t.status==="open"?"#e3f2fd":"#f3e5f5",color:t.status==="open"?"#1976d2":"#7b1fa2",padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.875rem",fontWeight:"500"},children:t.status?.replace("_"," ")})]}),e.jsxs("div",{style:{color:"#666",fontSize:"0.9rem",lineHeight:"1.4"},children:[t.description?.slice(0,150),t.description?.length>150?"...":""]})]},t.id))})]}),e.jsxs("div",{style:{background:"#fff",padding:"2rem",borderRadius:"12px",border:"1px solid #e1e5e9",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem",fontSize:"1.5rem"},children:"üìã Your Appointment Requests"}),h.length===0?e.jsx("div",{style:{background:"#f8f9fa",padding:"2rem",border:"1px solid #e1e5e9",borderRadius:"8px",textAlign:"center",color:"#666"},children:"No appointment requests yet."}):e.jsx("div",{style:{display:"grid",gap:"1rem"},children:h.map(t=>e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",border:"1px solid #e1e5e9",borderRadius:"8px",transition:"box-shadow 0.2s"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[e.jsx("strong",{style:{color:"#22314a",fontSize:"1rem"},children:t.title}),e.jsx("span",{style:{textTransform:"capitalize",background:t.status==="pending"?"#fff3cd":t.status==="approved"?"#d4edda":"#f8d7da",color:t.status==="pending"?"#856404":t.status==="approved"?"#155724":"#721c24",padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.875rem",fontWeight:"500"},children:t.status})]}),e.jsxs("div",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"0.5rem"},children:["üìÖ ",new Date(t.requestedDate).toLocaleString("en-AU")]}),t.address&&e.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:["üìç ",t.address]})]},t.id))})]})]})]})]}):e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:700,margin:"0 auto"},children:[e.jsx("h2",{children:"üîí Login required"}),e.jsx("p",{children:"Please log in to access your client portal."}),e.jsx("a",{href:"/login",className:"calendar-btn-main",children:"Go to Login"})]})};export{B as default};
