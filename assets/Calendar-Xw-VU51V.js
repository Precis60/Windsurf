import{j as e,a as F,b as C,c as V}from"./index-7Xsj5F6t.js";import{b as m}from"./vendor-DR4o8xae.js";const q=({value:L,onChange:M,label:N})=>{const[b,h]=m.useState(null),D=m.useRef(null),z=o=>{if(!o)return{hours:12,minutes:0};const[l,f]=o.split(":").map(Number);return{hours:l||12,minutes:f||0}},{hours:a,minutes:j}=z(L),B=a>12?a-12:a===0?12:a,v=B%12*30+j*.5-90,g=j*6-90,u=(o,l)=>{o.preventDefault(),h(l)},x=o=>{if(!b||!D.current)return;const l=D.current.getBoundingClientRect(),f=l.left+l.width/2,A=l.top+l.height/2,w=o.clientX||o.touches&&o.touches[0]?.clientX,S=o.clientY||o.touches&&o.touches[0]?.clientY;if(!w||!S)return;const P=(Math.atan2(S-A,w-f)*180/Math.PI+90+360)%360;if(b==="hour"){const R=Math.round(P/30)%12,I=R===0?12:R,E=a>=12?I===12?12:I+12:I;M(`${E.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`)}else if(b==="minute"){const R=Math.round(P/6)%60;M(`${a.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}`)}},d=()=>{h(null)};m.useEffect(()=>{if(b)return document.addEventListener("mousemove",x),document.addEventListener("mouseup",d),document.addEventListener("touchmove",x),document.addEventListener("touchend",d),()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",d),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",d)}},[b,a,j]);const W=[];for(let o=1;o<=12;o++){const l=(o*30-90)*Math.PI/180,f=50+35*Math.cos(l),A=50+35*Math.sin(l),w=50+40*Math.cos(l),S=50+40*Math.sin(l),T=50+32*Math.cos(l),P=50+32*Math.sin(l);W.push(e.jsxs("g",{children:[e.jsx("line",{x1:f,y1:A,x2:w,y2:S,stroke:"#333",strokeWidth:"2"}),e.jsx("text",{x:T,y:P,textAnchor:"middle",dominantBaseline:"central",fontSize:"12",fill:"#333",children:o})]},o))}const s=[];for(let o=0;o<60;o+=5)if(o%15!==0){const l=(o*6-90)*Math.PI/180,f=50+37*Math.cos(l),A=50+37*Math.sin(l),w=50+40*Math.cos(l),S=50+40*Math.sin(l);s.push(e.jsx("line",{x1:f,y1:A,x2:w,y2:S,stroke:"#666",strokeWidth:"1"},o))}return e.jsxs("div",{style:{margin:"1rem 0"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:N}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("div",{style:{position:"relative"},children:e.jsxs("svg",{ref:D,width:"200",height:"200",viewBox:"0 0 100 100",style:{border:"3px solid #22314a",borderRadius:"50%",background:"white",cursor:b?"grabbing":"grab",userSelect:"none"},children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"white",stroke:"#22314a",strokeWidth:"1"}),W,s,e.jsx("line",{x1:"50",y1:"50",x2:50+25*Math.cos(v*Math.PI/180),y2:50+25*Math.sin(v*Math.PI/180),stroke:"#22314a",strokeWidth:"4",strokeLinecap:"round",style:{cursor:"pointer"},onMouseDown:o=>u(o,"hour"),onTouchStart:o=>u(o,"hour")}),e.jsx("line",{x1:"50",y1:"50",x2:50+35*Math.cos(g*Math.PI/180),y2:50+35*Math.sin(g*Math.PI/180),stroke:"#dc3545",strokeWidth:"3",strokeLinecap:"round",style:{cursor:"pointer"},onMouseDown:o=>u(o,"minute"),onTouchStart:o=>u(o,"minute")}),e.jsx("circle",{cx:"50",cy:"50",r:"3",fill:"#22314a"}),e.jsx("circle",{cx:50+25*Math.cos(v*Math.PI/180),cy:50+25*Math.sin(v*Math.PI/180),r:"4",fill:"#22314a",style:{cursor:"pointer"},onMouseDown:o=>u(o,"hour"),onTouchStart:o=>u(o,"hour")}),e.jsx("circle",{cx:50+35*Math.cos(g*Math.PI/180),cy:50+35*Math.sin(g*Math.PI/180),r:"3",fill:"#dc3545",style:{cursor:"pointer"},onMouseDown:o=>u(o,"minute"),onTouchStart:o=>u(o,"minute")})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{background:"#f8f9fa",border:"2px solid #22314a",borderRadius:"8px",padding:"1rem",textAlign:"center",minWidth:"120px"},children:[e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#22314a",fontFamily:"monospace"},children:[B.toString().padStart(2,"0"),":",j.toString().padStart(2,"0")]}),e.jsx("div",{style:{fontSize:"14px",color:"#666",marginTop:"0.25rem"},children:a>=12?"PM":"AM"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:()=>{const o=a>=12?a-12:a;M(`${o.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`)},style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:a<12?"#22314a":"white",color:a<12?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"AM"}),e.jsx("button",{type:"button",onClick:()=>{const o=a<12?a+12:a;M(`${o.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`)},style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:a>=12?"#22314a":"white",color:a>=12?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"PM"})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",maxWidth:"150px",lineHeight:"1.4"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Blue hand:"})," Hours"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Red hand:"})," Minutes"]}),e.jsx("div",{children:"Drag hands to set time"})]})]})]})]})},J=()=>{const[L,M]=m.useState(!1),[N,b]=m.useState(!0),[h,D]=m.useState("monthly"),[z,a]=m.useState([]),[j,B]=m.useState([]),[v,g]=m.useState(!1),[u,x]=m.useState(null),[d,W]=m.useState(new Date),[s,o]=m.useState({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),l=["Site Survey","Network Installation","Cable Installation","Equipment Setup","Maintenance","Repair","Consultation","Training","Safety Inspection","Project Planning","Client Meeting ","Troubleshooting","Upgrade","Testing & Commissioning","Documentation","Emergency Call","Preventive Maintenance","System Integration","Quality Assurance","Follow-up"];m.useEffect(()=>{(()=>{const n=F.isAuthenticated();M(n),b(!1)})()},[]),m.useEffect(()=>{L&&(async()=>{try{const n=await C.getAll(),i=Array.isArray(n)?n:n.appointments||[];console.log("Loaded appointments:",i),a(i);const r=await V.getAll(),c=Array.isArray(r)?r:r.customers||[];B(c)}catch(n){console.error("Error loading data:",n),a([]),B([])}})()},[L]);const f=async t=>{t.preventDefault(),console.log("Attempting to create appointment with data:",s);try{const n={title:s.title,description:s.description||`Client: ${s.client}
Category: ${s.category}
Address: ${s.address}`,appointmentDate:`${s.date}T${s.time}:00.000Z`,durationMinutes:A(s.time,s.endTime),customerId:s.customerId||null};console.log("Sending appointment data to backend:",n);const i=await C.create(n);console.log("Appointment created successfully:",i),o({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),g(!1);const r=await C.getAll(),c=Array.isArray(r)?r:r.appointments||[];console.log("Reloaded appointments after creation:",c),a(c),alert("Appointment added successfully!")}catch(n){console.error("Detailed error adding appointment:",n),console.error("Error message:",n.message),console.error("Error stack:",n.stack),console.error("Full error object:",JSON.stringify(n,null,2));let i="Failed to add appointment. ";if(n.message.includes("Authentication required")){i+="Please log in again.",window.location.href="/login";return}else if(n.message.includes("Session expired")){i+="Your session has expired. Please log in again.",window.location.href="/login";return}else n.message.includes("Failed to fetch")||n.message.includes("NetworkError")?i+="Network error - backend server may not be running. Please check if the backend is started.":n.message.includes("Validation failed")?i+="Please check all required fields are filled correctly.":n.message.includes("Customer not found")?i+="The selected customer was not found.":n.message.includes("Time slot conflicts")?i+="This time slot conflicts with an existing appointment.":i+=`Error: ${n.message}`;console.log("=== APPOINTMENT CREATION ERROR DEBUG ==="),console.log("Appointment data being sent:",appointmentData),console.log("Error type:",typeof n),console.log("Error constructor:",n.constructor.name),console.log("Is network error:",n.message.includes("Failed to fetch")),console.log("Current auth status:",F.isAuthenticated()),console.log("Backend URL:","https://precision-cabling-backend.onrender.com/api"),console.log("====================================="),alert(i)}},A=(t,n)=>{const[i,r]=t.split(":").map(Number),[c,p]=n.split(":").map(Number),k=i*60+r;return c*60+p-k},w=async t=>{t.preventDefault();try{await C.update(u,s),o({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""}),x(null),g(!1);const n=await C.getAll(),i=Array.isArray(n)?n:n.appointments||[];a(i)}catch(n){console.error("Error updating appointment:",n),alert("Failed to update appointment. Please try again.")}},S=async t=>{if(window.confirm("Are you sure you want to delete this appointment?"))try{await C.delete(t);const n=await C.getAll(),i=Array.isArray(n)?n:n.appointments||[];a(i)}catch(n){console.error("Error deleting appointment:",n),alert("Failed to delete appointment. Please try again.")}},T=t=>{const n=t.toISOString().split("T")[0];return z.filter(i=>{const r=i.appointmentDate||i.date;return r?r.split("T")[0]===n:!1})},P=()=>{const t=d.getFullYear(),n=d.getMonth(),i=new Date(t,n,1),r=new Date(i);r.setDate(r.getDate()-i.getDay());const c=[];for(let p=0;p<42;p++){const k=new Date(r);k.setDate(r.getDate()+p),c.push(k)}return c},R=()=>{const t=new Date(d);t.setDate(d.getDate()-d.getDay());const n=[];for(let i=0;i<7;i++){const r=new Date(t);r.setDate(t.getDate()+i),n.push(r)}return n},I=t=>{const n=new Date(d);switch(h){case"monthly":n.setMonth(d.getMonth()+t);break;case"weekly":n.setDate(d.getDate()+t*7);break;case"daily":n.setDate(d.getDate()+t);break}W(n)},E=()=>{const t=[];for(let n=0;n<24;n++)for(let i=0;i<60;i+=15){const r=`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`;t.push(r)}return t},y={background:"#22314a",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"4px",cursor:"pointer",margin:"0 0.5rem"},H={...y,background:"#1a2538"};return N?e.jsx("div",{className:"page-content",style:{padding:"2rem",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:e.jsxs("div",{style:{textAlign:"center",color:"#666"},children:[e.jsx("h2",{children:"Loading Calendar..."}),e.jsx("p",{children:"Please wait while we load your calendar data."})]})}):L?e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h1",{style:{color:"#22314a",margin:0},children:"Calendar Management"}),e.jsx("button",{onClick:()=>{F.logout(),M(!1),window.location.href="/"},style:{...y,background:"#dc3545"},children:"Logout"})]}),e.jsx("p",{style:{marginBottom:"2rem",fontSize:"1.1rem"},children:"Manage appointments and view your schedule."}),e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("button",{style:h==="monthly"?H:y,onClick:()=>D("monthly"),children:"Monthly View"}),e.jsx("button",{style:h==="weekly"?H:y,onClick:()=>D("weekly"),children:"Weekly View"}),e.jsx("button",{style:h==="daily"?H:y,onClick:()=>D("daily"),children:"Daily View"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"2rem"},children:e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef",width:"100%",maxWidth:"600px"},children:[e.jsx("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:"Appointment Management"}),e.jsx("button",{style:y,onClick:()=>{g(!v),x(null),o({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""})},children:v?"Cancel":"Add New Appointment"}),v&&e.jsxs("form",{onSubmit:u?w:f,style:{marginTop:"1rem"},children:[e.jsx("input",{type:"text",placeholder:"Appointment Title",value:s.title,onChange:t=>o({...s,title:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"text",placeholder:"Client Name",value:s.client,onChange:t=>o({...s,client:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"date",value:s.date,onChange:t=>o({...s,date:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx(q,{label:"Start Time",value:s.time,onChange:t=>o({...s,time:t})}),e.jsx(q,{label:"End Time",value:s.endTime,onChange:t=>o({...s,endTime:t})}),e.jsxs("select",{value:s.category,onChange:t=>o({...s,category:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"},children:[e.jsx("option",{value:"",children:"Select Category"}),l.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",placeholder:"Address/Location",value:s.address,onChange:t=>o({...s,address:t.target.value}),style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("textarea",{placeholder:"Description",value:s.description,onChange:t=>o({...s,description:t.target.value}),style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc",minHeight:"60px"}}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{type:"submit",style:{...y,flex:1},children:u?"Update Appointment":"Add Appointment"}),u&&e.jsx("button",{type:"button",onClick:()=>{window.confirm("Are you sure you want to delete this appointment?")&&S(u)},style:{...y,background:"#dc3545",flex:1},children:"Delete Appointment"})]})]})]})}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("button",{onClick:()=>I(-1),style:y,children:"‚Äπ Previous"}),e.jsxs("h3",{style:{color:"#22314a",margin:0},children:[h==="monthly"&&d.toLocaleDateString("en-US",{month:"long",year:"numeric"}),h==="weekly"&&`Week of ${d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,h==="daily"&&d.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})]}),e.jsx("button",{onClick:()=>I(1),style:y,children:"Next ‚Ä∫"})]}),h==="monthly"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"1px"},children:P().map((t,n)=>{const i=T(t),r=t.getMonth()===d.getMonth(),c=t.toDateString()===new Date().toDateString();return e.jsxs("div",{style:{minHeight:"100px",padding:"0.25rem",background:r?"white":"#f8f9fa",border:c?"2px solid #22314a":"1px solid #dee2e6",opacity:r?1:.6},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.25rem"},children:t.getDate()}),i.map(p=>e.jsxs("div",{style:{background:"#e3f2fd",padding:"2px 4px",margin:"1px 0",borderRadius:"3px",fontSize:"0.7rem",cursor:"pointer",border:"1px solid #2196f3"},onClick:()=>{o(p),x(p.id),g(!0)},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[p.time," - ",p.endTime," ",p.title]}),e.jsx("div",{children:p.client})]},p.id))]},n)})}),h==="weekly"&&e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{width:"80px",borderRight:"1px solid #dee2e6"},children:[e.jsx("div",{style:{height:"40px",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"}}),E().map((t,n)=>e.jsx("div",{style:{height:"15px",fontSize:"0.7rem",padding:"0 0.25rem",borderBottom:n%4===3?"1px solid #ccc":"1px solid #f0f0f0",display:"flex",alignItems:"center",background:"#f8f9fa",justifyContent:"flex-end"},children:n%4===0?t:""},t))]}),e.jsx("div",{style:{flex:1,display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"1px"},children:R().map((t,n)=>{const i=T(t);return t.toDateString(),new Date().toDateString(),e.jsxs("div",{style:{background:"white",border:"1px solid #dee2e6",position:"relative"},children:[e.jsx("div",{style:{height:"40px",fontWeight:"bold",padding:"0.5rem",textAlign:"center",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"},children:t.toLocaleDateString("en-US",{weekday:"short",month:"numeric",day:"numeric"})}),e.jsxs("div",{style:{height:`${15*96}px`,position:"relative"},children:[E().map((r,c)=>e.jsx("div",{style:{height:"15px",borderBottom:c%4===3?"1px solid #ccc":"1px solid #f0f0f0"}},r)),i.map(r=>{const[c,p]=r.time.split(":").map(Number),[k,$]=r.endTime.split(":").map(Number),U=(c*60+p)/15*15,Y=(k*60+$)/15*15,O=Math.max(30,Y-U);return e.jsxs("div",{style:{position:"absolute",top:`${U}px`,left:"2px",right:"2px",height:`${O}px`,fontSize:"0.7rem",padding:"0.25rem",background:"#22314a",color:"white",borderRadius:"4px",cursor:"pointer",zIndex:1},onClick:()=>{o(r),x(r.id),g(!0)},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[r.time," - ",r.endTime," ",r.title]}),e.jsx("div",{children:r.client})]},r.id)})]})]},n)})})]}),h==="daily"&&e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{width:"80px",borderRight:"1px solid #dee2e6"},children:[e.jsx("div",{style:{height:"40px",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"}}),E().map((t,n)=>e.jsx("div",{style:{height:"15px",fontSize:"0.7rem",padding:"0 0.25rem",borderBottom:n%4===3?"1px solid #ccc":"1px solid #f0f0f0",display:"flex",alignItems:"center",background:"#f8f9fa",justifyContent:"flex-end"},children:n%4===0?t:""},t))]}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",border:"1px solid #dee2e6",position:"relative"},children:[e.jsx("div",{style:{height:"40px",fontWeight:"bold",padding:"0.5rem",textAlign:"center",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"},children:d.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsxs("div",{style:{height:`${15*96}px`,position:"relative"},children:[E().map((t,n)=>e.jsx("div",{style:{height:"15px",borderBottom:n%4===3?"1px solid #ccc":"1px solid #f0f0f0"}},t)),T(d).map(t=>{const[n,i]=t.time.split(":").map(Number),[r,c]=t.endTime.split(":").map(Number),p=(n*60+i)/15*15,k=(r*60+c)/15*15,$=Math.max(30,k-p);return e.jsxs("div",{style:{position:"absolute",top:`${p}px`,left:"2px",right:"2px",height:`${$}px`,fontSize:"0.8rem",padding:"0.5rem",background:"#22314a",color:"white",borderRadius:"4px",cursor:"pointer",zIndex:1},onClick:()=>{o(t),x(t.id),g(!0)},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[t.time," - ",t.endTime," ",t.title]}),e.jsx("div",{children:t.client}),e.jsx("div",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:t.category})]},t.id)})]})]})})]})]})]}):e.jsx("div",{className:"page-content",style:{padding:"2rem",maxWidth:"600px",margin:"0 auto"},children:e.jsxs("div",{style:{background:"#f8f9fa",padding:"2rem",borderRadius:"8px",border:"1px solid #e9ecef",textAlign:"center"},children:[e.jsx("h1",{style:{color:"#22314a",marginBottom:"1rem"},children:"üîí Calendar Access Required"}),e.jsx("p",{style:{marginBottom:"2rem",fontSize:"1.1rem",color:"#666"},children:"Please log in to access the secure calendar management system."}),e.jsx("div",{style:{background:"#e8f5e8",border:"1px solid #4caf50",borderRadius:"8px",padding:"20px",marginBottom:"20px"},children:e.jsxs("p",{style:{margin:0,color:"#2e7d32",fontSize:"14px"},children:["üîê ",e.jsx("strong",{children:"Secure Access:"})," This calendar contains sensitive business information and requires authentication."]})}),e.jsx("a",{href:"/login",style:{background:"#22314a",color:"white",padding:"12px 24px",borderRadius:"8px",textDecoration:"none",fontSize:"16px",fontWeight:"500",display:"inline-block"},children:"Go to Login Page"})]})})};export{J as default};
