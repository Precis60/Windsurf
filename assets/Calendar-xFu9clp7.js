import{j as e,a as X,b as M,c as te}from"./index-Dgj-CLL8.js";import{b as p}from"./vendor-DR4o8xae.js";const q=({value:y,onChange:j,label:C})=>{const[m,A]=p.useState("hour"),g=p.useRef(null),I=r=>{if(!r)return{hours:12,minutes:0};const[u,i]=r.split(":").map(Number);return{hours:u||12,minutes:i||0}},{hours:h,minutes:f}=I(y),L=h>12?h-12:h===0?12:h,P=L%12*30+f*.5-90,T=f*6-90,N=r=>{if(!g.current)return;const u=g.current.getBoundingClientRect(),i=u.left+u.width/2,d=u.top+u.height/2,v=r.clientX||r.touches&&r.touches[0]?.clientX,S=r.clientY||r.touches&&r.touches[0]?.clientY;if(!v||!S)return;const D=(Math.atan2(S-d,v-i)*180/Math.PI+90+360)%360;if(m==="hour"){const k=Math.round(D/30)%12,W=k===0?12:k,$=h>=12?W===12?12:W+12:W;j(`${$.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`),A("minute")}else if(m==="minute"){const k=Math.round(D/6)%60;j(`${h.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`)}},w=[];for(let r=1;r<=12;r++){const u=(r*30-90)*Math.PI/180,i=50+35*Math.cos(u),d=50+35*Math.sin(u),v=50+40*Math.cos(u),S=50+40*Math.sin(u),E=50+32*Math.cos(u),D=50+32*Math.sin(u);w.push(e.jsxs("g",{children:[e.jsx("line",{x1:i,y1:d,x2:v,y2:S,stroke:"#333",strokeWidth:"2"}),e.jsx("text",{x:E,y:D,textAnchor:"middle",dominantBaseline:"central",fontSize:"12",fill:"#333",children:r})]},r))}const b=[];for(let r=0;r<60;r+=5)if(r%15!==0){const u=(r*6-90)*Math.PI/180,i=50+37*Math.cos(u),d=50+37*Math.sin(u),v=50+40*Math.cos(u),S=50+40*Math.sin(u);b.push(e.jsx("line",{x1:i,y1:d,x2:v,y2:S,stroke:"#666",strokeWidth:"1"},r))}return e.jsxs("div",{style:{margin:"1rem 0"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:C}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("div",{style:{position:"relative"},children:e.jsxs("svg",{ref:g,width:"200",height:"200",viewBox:"0 0 100 100",onClick:N,style:{border:`3px solid ${m==="hour"?"#22314a":"#dc3545"}`,borderRadius:"50%",background:m==="hour"?"#f8f9ff":"#fff8f8",cursor:"pointer",userSelect:"none"},children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"hour-arrow",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"1.5",markerHeight:"1.5",orient:"auto-start-reverse",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:m==="hour"?"#22314a":"#aaa"})}),e.jsx("marker",{id:"minute-arrow",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"4",markerHeight:"4",orient:"auto-start-reverse",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:m==="minute"?"#dc3545":"#aaa"})})]}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"white",stroke:"#22314a",strokeWidth:"1"}),w,b,e.jsx("line",{x1:"50",y1:"50",x2:50+9*Math.cos(P*Math.PI/180),y2:50+9*Math.sin(P*Math.PI/180),stroke:m==="hour"?"#22314a":"#aaa",strokeWidth:m==="hour"?"3":"1",markerEnd:"url(#hour-arrow)",pointerEvents:"none"}),e.jsx("line",{x1:"50",y1:"50",x2:50+35*Math.cos(T*Math.PI/180),y2:50+35*Math.sin(T*Math.PI/180),stroke:m==="minute"?"#dc3545":"#aaa",strokeWidth:m==="minute"?"3":"1",markerEnd:"url(#minute-arrow)",pointerEvents:"none"}),e.jsx("circle",{cx:"50",cy:"50",r:"3",fill:"#22314a",pointerEvents:"none"})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{background:"#f8f9fa",border:"2px solid #22314a",borderRadius:"8px",padding:"1rem",textAlign:"center",minWidth:"120px"},children:[e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#22314a",fontFamily:"monospace"},children:[L.toString().padStart(2,"0"),":",f.toString().padStart(2,"0")]}),e.jsx("div",{style:{fontSize:"14px",color:"#666",marginTop:"0.25rem"},children:h>=12?"PM":"AM"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:()=>{const r=h>=12?h-12:h;j(`${r.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`)},style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:h<12?"#22314a":"white",color:h<12?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"AM"}),e.jsx("button",{type:"button",onClick:()=>{const r=h<12?h+12:h;j(`${r.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`)},style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:h>=12?"#22314a":"white",color:h>=12?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"PM"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:()=>A("hour"),style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:m==="hour"?"#22314a":"white",color:m==="hour"?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Hours"}),e.jsx("button",{type:"button",onClick:()=>A("minute"),style:{padding:"0.5rem 1rem",border:"2px solid #dc3545",borderRadius:"4px",background:m==="minute"?"#dc3545":"white",color:m==="minute"?"white":"#dc3545",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Minutes"})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",maxWidth:"150px",lineHeight:"1.4",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:"bold",color:m==="hour"?"#22314a":"#dc3545"},children:m==="hour"?"Setting Hours":"Setting Minutes"}),e.jsxs("div",{children:["Click anywhere on the clock face to set the ",m==="hour"?"hour":"minute"]})]})]})]})]})},ne=({open:y,title:j,message:C,onConfirm:m,onCancel:A})=>y?e.jsx("div",{className:"custom-modal-overlay",children:e.jsxs("div",{className:"custom-modal",children:[e.jsx("h3",{className:"custom-modal-title",children:j}),e.jsx("div",{className:"custom-modal-message",children:C}),e.jsxs("div",{className:"custom-modal-actions",children:[e.jsx("button",{className:"custom-modal-btn confirm",onClick:m,children:"Yes, Delete"}),e.jsx("button",{className:"custom-modal-btn cancel",onClick:A,children:"Cancel"})]})]})}):null,ie=()=>{const y="Australia/Sydney",[j,C]=p.useState(!1),[m,A]=p.useState(!0),[g,I]=p.useState("monthly"),[h,f]=p.useState([]),[L,P]=p.useState([]),[T,N]=p.useState(!1),[w,b]=p.useState(null),[r,u]=p.useState(new Date),[i,d]=p.useState({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),[v,S]=p.useState(""),[E,D]=p.useState(!1),k=L.filter(t=>`${t.firstName} ${t.lastName}`.toLowerCase().includes(v.toLowerCase())),W=["Site Survey","Network Installation","Cable Installation","Equipment Setup","Maintenance","Repair","Consultation","Training","Safety Inspection","Project Planning","Client Meeting ","Troubleshooting","Upgrade","Testing & Commissioning","Documentation","Emergency Call","Preventive Maintenance","System Integration","Quality Assurance","Follow-up"];p.useEffect(()=>{(()=>{const n=X.isAuthenticated();C(n),A(!1)})()},[]);const $=t=>{if(!t.appointmentDate)return t;const n=new Date(t.appointmentDate),o=new Intl.DateTimeFormat("en-CA",{timeZone:y,year:"numeric",month:"2-digit",day:"2-digit"}).format(n),l=new Intl.DateTimeFormat("en-AU",{timeZone:y,hour:"2-digit",minute:"2-digit",hour12:!1}).format(n);let s=l;if(t.durationMinutes){const a=new Date(n.getTime()+t.durationMinutes*6e4);s=new Intl.DateTimeFormat("en-AU",{timeZone:y,hour:"2-digit",minute:"2-digit",hour12:!1}).format(a)}return{...t,time:l,endTime:s,date:o,appointmentDate:t.appointmentDate}};p.useEffect(()=>{j&&(async()=>{try{const n=await M.getAll(),o=Array.isArray(n)?n:n.appointments||[];console.log("Loaded raw appointments:",o);const l=o.map($);console.log("Transformed appointments:",l),f(l);const s=await te.getAll(),a=Array.isArray(s)?s:s.customers||[];P(a)}catch(n){console.error("Error loading data:",n),f([]),P([])}})()},[j]);const V=async t=>{t.preventDefault(),console.log("Attempting to create appointment with data:",i);const n=z(i.time,i.endTime);if(isNaN(n)||n<15||n>480){alert("Duration must be between 15 and 480 minutes.");return}if(!i.customerId||isNaN(Number(i.customerId))||!Number.isInteger(Number(i.customerId))){alert("Please select a valid client from the dropdown.");return}const o=`${i.date}T${i.time}:00`,l=new Date(o),s={title:i.title,description:i.description||`Client: ${i.client}
Category: ${i.category}
Address: ${i.address}`,appointmentDate:l.toISOString(),durationMinutes:n,customerId:Number(i.customerId)};console.log("Appointment payload:",s),Object.keys(s).forEach(a=>{console.log(`${a}:`,s[a],"type:",typeof s[a])});try{const a=await M.create(s);console.log("Appointment created successfully:",a),d({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),N(!1);const c=await M.getAll(),U=(Array.isArray(c)?c:c.appointments||[]).map($);f(U),alert("Appointment added successfully!")}catch(a){let c="Failed to add appointment. ";a.response&&a.response.data&&a.response.data.error?(typeof a.response.data.error=="string"?c+=a.response.data.error:a.response.data.error.message?c+=a.response.data.error.message:c+=JSON.stringify(a.response.data.error),a.response.data.error.details&&(c+=`
Details:`,a.response.data.error.details.forEach(x=>{c+=`
- ${x.path}: ${x.msg} (value: ${x.value})`}))):a.message&&(c+=a.message),alert(c)}},z=(t,n)=>{const[o,l]=t.split(":").map(Number),[s,a]=n.split(":").map(Number),c=o*60+l;return s*60+a-c},G=async t=>{t.preventDefault();const n=`${i.date}T${i.time}:00`,o=new Date(n),l=z(i.time,i.endTime),s={...i,appointmentDate:o.toISOString(),durationMinutes:l};try{await M.update(w,s),d({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""}),b(null),N(!1);const a=await M.getAll(),x=(Array.isArray(a)?a:a.appointments||[]).map($);f(x)}catch(a){console.error("Error updating appointment:",a),alert("Failed to update appointment. Please try again.")}},[B,H]=p.useState({open:!1,id:null}),J=async t=>{H({open:!0,id:t})},Q=async()=>{const t=B.id;H({open:!1,id:null});try{await M.delete(t);const n=await M.getAll(),l=(Array.isArray(n)?n:n.appointments||[]).map($);f(l)}catch(n){console.error("Error deleting appointment:",n),alert("Failed to delete appointment. Please try again.")}},R=t=>{const n=new Intl.DateTimeFormat("en-CA",{timeZone:y,year:"numeric",month:"2-digit",day:"2-digit"}).format(t);return h.filter(o=>o.date===n)},Z=()=>{const t=Number(new Intl.DateTimeFormat("en-US",{timeZone:y,year:"numeric"}).format(r)),n=Number(new Intl.DateTimeFormat("en-US",{timeZone:y,month:"numeric"}).format(r))-1,o=new Date(t,n,1),l=o.getDay();let s=new Date(o);s.setDate(s.getDate()-l);const a=[];for(let c=0;c<42;c++){const x=new Date(s);x.setDate(s.getDate()+c),a.push(x)}return a},K=()=>{const t=r.getDay(),n=new Date(r);n.setDate(r.getDate()-t);const o=[];for(let l=0;l<7;l++){const s=new Date(n);s.setDate(n.getDate()+l),o.push(s)}return o},O=t=>{const n=new Date(r);switch(g){case"monthly":n.setMonth(r.getMonth()+t);break;case"weekly":n.setDate(r.getDate()+t*7);break;case"daily":n.setDate(r.getDate()+t);break}u(n)},F=()=>{const t=[];for(let n=0;n<24;n++)for(let o=0;o<60;o+=15){const l=`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;t.push(l)}return t};return m?e.jsx("div",{className:"calendar-container",style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("h2",{children:"Loading Calendar..."})}):j?e.jsxs("div",{className:"calendar-container",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("h1",{className:"calendar-title",children:"Calendar Management"}),e.jsx("button",{className:"calendar-logout-btn",onClick:()=>{X.logout(),C(!1),window.location.href="/"},children:"Logout"})]}),e.jsx("div",{className:"calendar-dashboard",children:e.jsxs("div",{className:"calendar-card",children:[e.jsx("h3",{children:"Appointment Management"}),e.jsx("p",{children:"View and manage appointments, clients, and schedules."}),e.jsx("button",{className:"calendar-btn-main",onClick:()=>{N(!T),b(null),d({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""})},children:T?"Cancel":"Add New Appointment"})]})}),T&&e.jsxs("div",{className:"calendar-section",children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem"},children:w?"Edit Appointment":"Add New Appointment"}),e.jsxs("form",{className:"calendar-form",onSubmit:t=>{if(t.preventDefault(),!i.customerId){alert("Please select a valid client from the dropdown.");return}(w?G:V)(t)},noValidate:!0,children:[e.jsx("input",{type:"text",placeholder:"Appointment Title",value:i.title,onChange:t=>d({...i,title:t.target.value}),required:!0,className:"calendar-input"}),e.jsxs("div",{className:"calendar-client-select",children:[e.jsx("input",{type:"text",placeholder:"Select Client",value:v||i.client,onChange:t=>{S(t.target.value),D(!0),d({...i,client:t.target.value,customerId:""})},onBlur:()=>{setTimeout(()=>D(!1),200),L.find(n=>`${n.firstName} ${n.lastName}`.toLowerCase()===v.toLowerCase())||d(n=>({...n,customerId:""}))},onFocus:()=>D(!0),autoComplete:"off",required:!0,className:"calendar-input"}),E&&k.length>0&&e.jsx("div",{className:"calendar-client-dropdown",children:k.map(t=>e.jsxs("div",{className:"calendar-client-option",onClick:()=>{d({...i,client:`${t.firstName} ${t.lastName}`,customerId:t.id}),S(`${t.firstName} ${t.lastName}`),D(!1)},children:[t.firstName," ",t.lastName," ",t.company?`(${t.company})`:""]},t.id))})]}),e.jsx("input",{type:"date",value:i.date,onChange:t=>d({...i,date:t.target.value}),required:!0,className:"calendar-input"}),e.jsx(q,{label:"Start Time",value:i.time,onChange:t=>d({...i,time:t})}),e.jsx(q,{label:"End Time",value:i.endTime,onChange:t=>d({...i,endTime:t})}),e.jsxs("select",{value:i.category,onChange:t=>d({...i,category:t.target.value}),required:!0,className:"calendar-select",children:[e.jsx("option",{value:"",children:"Select Category"}),W.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",placeholder:"Address/Location",value:i.address,onChange:t=>d({...i,address:t.target.value}),className:"calendar-input"}),e.jsx("textarea",{placeholder:"Description",value:i.description,onChange:t=>d({...i,description:t.target.value}),className:"calendar-textarea"}),e.jsxs("div",{className:"calendar-form-actions",children:[e.jsx("button",{className:"calendar-btn-main",type:"submit",children:w?"Update Appointment":"Add Appointment"}),e.jsx("button",{className:"calendar-btn-secondary",type:"button",onClick:()=>{N(!1),b(null)},children:"Cancel"}),w&&e.jsx("button",{className:"calendar-btn-delete",type:"button",onClick:()=>J(w),children:"Delete"})]})]})]}),e.jsxs("div",{className:"calendar-section",children:[e.jsxs("div",{className:"calendar-nav-header",children:[e.jsx("button",{onClick:()=>O(-1),className:"calendar-nav-btn",children:"‹ Previous"}),e.jsxs("h3",{className:"calendar-nav-title",children:[g==="monthly"&&new Intl.DateTimeFormat("en-AU",{timeZone:y,month:"long",year:"numeric"}).format(r),g==="weekly"&&`Week of ${new Intl.DateTimeFormat("en-AU",{timeZone:y,month:"short",day:"numeric",year:"numeric"}).format(r)}`,g==="daily"&&new Intl.DateTimeFormat("en-AU",{timeZone:y,weekday:"long",month:"long",day:"numeric",year:"numeric"}).format(r)]}),e.jsx("button",{onClick:()=>O(1),className:"calendar-nav-btn",children:"Next ›"}),e.jsxs("div",{className:"calendar-view-switcher",children:[e.jsx("button",{className:`calendar-view-btn${g==="monthly"?" active":""}`,onClick:()=>I("monthly"),type:"button",children:"Monthly"}),e.jsx("button",{className:`calendar-view-btn${g==="weekly"?" active":""}`,onClick:()=>I("weekly"),type:"button",children:"Weekly"}),e.jsx("button",{className:`calendar-view-btn${g==="daily"?" active":""}`,onClick:()=>I("daily"),type:"button",children:"Daily"})]})]}),g==="monthly"&&e.jsx("div",{className:"calendar-monthly-grid",children:Z().map((t,n)=>{const o=R(t),l=t.getMonth()===r.getMonth(),s=t.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`calendar-day ${l?"":"calendar-day-muted"} ${s?"calendar-day-today":""}`,children:[e.jsx("div",{className:"calendar-day-date",children:t.getDate()}),o.filter(a=>{const c=a.time&&a.endTime&&String(a.time).trim()&&String(a.endTime).trim();return console.log("Appointment filter check:",a.id,"hasTime:",c,"time:",a.time,"endTime:",a.endTime),c}).map(a=>e.jsxs("div",{className:"calendar-appointment",onClick:()=>{d(a),b(a.id),N(!0)},children:[e.jsxs("div",{className:"calendar-appointment-time",children:[a.time," - ",a.endTime]}),e.jsx("div",{className:"calendar-appointment-title",children:a.title})]},a.id))]},n)})}),g==="weekly"&&e.jsxs("div",{className:"calendar-weekly-grid",children:[e.jsxs("div",{className:"calendar-time-slots",children:[e.jsx("div",{className:"calendar-time-slot-header"}),F().map((t,n)=>e.jsx("div",{className:"calendar-time-slot",children:n%4===0?t:""},t))]}),e.jsx("div",{className:"calendar-days-grid",children:K().map((t,n)=>{const o=R(t),l=t.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`calendar-day ${l?"calendar-day-today":""}`,children:[e.jsx("div",{className:"calendar-day-header",children:t.toLocaleDateString("en-US",{weekday:"short",month:"numeric",day:"numeric"})}),e.jsxs("div",{className:"calendar-day-body",children:[F().map((s,a)=>e.jsx("div",{className:"calendar-time-slot"},s)),o.filter(s=>{const a=s.time&&s.endTime&&String(s.time).trim()&&String(s.endTime).trim();return console.log("Weekly view appointment filter:",s.id,"hasTime:",a,"time:",s.time,"endTime:",s.endTime),a}).map(s=>{const[a,c]=s.time.split(":").map(Number),[x,U]=s.endTime.split(":").map(Number),Y=(a*60+c)/15*15,_=(x*60+U)/15*15,ee=Math.max(30,_-Y);return e.jsxs("div",{className:"calendar-appointment",style:{top:`${Y}px`,height:`${ee}px`},onClick:()=>{d(s),b(s.id),N(!0)},children:[e.jsxs("div",{className:"calendar-appointment-time",children:[s.time," - ",s.endTime]}),e.jsx("div",{className:"calendar-appointment-title",children:s.title})]},s.id)})]})]},n)})})]}),g==="daily"&&e.jsxs("div",{className:"calendar-daily-grid",children:[e.jsxs("div",{className:"calendar-time-slots",children:[e.jsx("div",{className:"calendar-time-slot-header"}),F().map((t,n)=>e.jsx("div",{className:"calendar-time-slot",children:n%4===0?t:""},t))]}),e.jsxs("div",{className:"calendar-single-day",children:[e.jsx("div",{className:"calendar-day-header",children:r.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsxs("div",{className:"calendar-day-body",children:[F().map((t,n)=>e.jsx("div",{className:"calendar-time-slot"},t)),R(r).filter(t=>{const n=t.time&&t.endTime&&String(t.time).trim()&&String(t.endTime).trim();return console.log("Daily view appointment filter:",t.id,"hasTime:",n,"time:",t.time,"endTime:",t.endTime),n}).map(t=>{const[n,o]=t.time.split(":").map(Number),[l,s]=t.endTime.split(":").map(Number),a=(n*60+o)/15*15,c=(l*60+s)/15*15,x=Math.max(30,c-a);return e.jsxs("div",{className:"calendar-appointment",style:{top:`${a}px`,height:`${x}px`},onClick:()=>{d(t),b(t.id),N(!0)},children:[e.jsxs("div",{className:"calendar-appointment-time",children:[t.time," - ",t.endTime]}),e.jsx("div",{className:"calendar-appointment-title",children:t.title}),e.jsx("div",{className:"calendar-appointment-category",children:t.category})]},t.id)})]})]})]})]}),e.jsx(ne,{open:B.open,title:"Delete Appointment",message:"Are you sure you want to delete this appointment? This action cannot be undone.",onConfirm:Q,onCancel:()=>H({open:!1,id:null})})]}):e.jsx("div",{className:"calendar-container",children:e.jsxs("div",{className:"calendar-card",style:{maxWidth:500,margin:"3rem auto",textAlign:"center"},children:[e.jsx("h1",{className:"calendar-title",children:"🔒 Calendar Access Required"}),e.jsx("p",{style:{color:"#666",marginBottom:24},children:"Please log in to access the calendar system."}),e.jsx("a",{href:"/login",className:"calendar-btn-main",children:"Go to Login Page"})]})})};export{ie as default};
