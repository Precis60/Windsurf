import{a as b,j as e,s as v,b as c}from"./index-f1PEzFj3.js";import{b as d}from"./vendor-DPLMwiL-.js";import{A as x,a as S}from"./AddressAutocomplete-Cfrbwt8E.js";const w=()=>{const[u,g]=d.useState([]),[p,m]=d.useState([]),[y,h]=d.useState(!0),[s,i]=d.useState({title:"",description:"",date:"",time:"",endTime:"",address:"",addressMeta:null}),j=(t,a)=>{const[n,l]=t.split(":").map(Number),[o,r]=a.split(":").map(Number);return o*60+r-(n*60+l)};d.useEffect(()=>{(async()=>{h(!0);try{const a=await v.getTickets();g(Array.isArray(a)?a:a.tickets||[]);const n=await c.getAll();m(Array.isArray(n)?n:n.requests||[])}catch(a){console.error("Client portal load error:",a)}finally{h(!1)}})()},[]);const f=async t=>{t.preventDefault();const a=j(s.time,s.endTime);if(isNaN(a)||a<15||a>480){alert("Duration must be between 15 and 480 minutes.");return}const n=`${s.date}T${s.time}:00`,l=new Date(n),o={title:s.title,description:s.description,requestedDate:l.toISOString(),durationMinutes:a,address:s.address||"",addressPlaceId:s.addressMeta?.placeId||null,addressLat:s.addressMeta?.lat??null,addressLng:s.addressMeta?.lng??null,addressComponents:s.addressMeta?.components||null};try{await c.create(o),alert("Your appointment request has been submitted. We will review and confirm."),i({title:"",description:"",date:"",time:"",endTime:"",address:"",addressMeta:null});const r=await c.getAll();m(Array.isArray(r)?r:r.requests||[])}catch(r){console.error("Submit request error:",r),alert(r?.message||"Failed to submit request")}};return b.isAuthenticated()?e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:1200,margin:"0 auto"},children:[e.jsx("h1",{style:{color:"#22314a"},children:"Client Portal"}),e.jsx("p",{children:"View your support tickets and request a tentative appointment for a site visit."}),y?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"2rem"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{color:"#22314a"},children:"Your Support Tickets"}),u.length===0?e.jsx("div",{style:{background:"#fff",padding:20,border:"1px solid #e1e5e9",borderRadius:8},children:"No tickets yet."}):e.jsx("div",{style:{display:"grid",gap:"12px"},children:u.map(t=>e.jsxs("div",{style:{background:"#fff",padding:16,border:"1px solid #e1e5e9",borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("strong",{children:["#",t.id," - ",t.subject]}),e.jsx("span",{style:{textTransform:"capitalize"},children:t.status?.replace("_"," ")})]}),e.jsxs("div",{style:{color:"#666",fontSize:14},children:[t.description?.slice(0,120),"..."]})]},t.id))}),e.jsx("h2",{style:{color:"#22314a",marginTop:"2rem"},children:"Your Appointment Requests"}),p.length===0?e.jsx("div",{style:{background:"#fff",padding:20,border:"1px solid #e1e5e9",borderRadius:8},children:"No appointment requests yet."}):e.jsx("div",{style:{display:"grid",gap:"12px"},children:p.map(t=>e.jsxs("div",{style:{background:"#fff",padding:16,border:"1px solid #e1e5e9",borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("strong",{children:t.title}),e.jsx("span",{style:{textTransform:"capitalize"},children:t.status})]}),e.jsx("div",{style:{color:"#666",fontSize:14},children:new Date(t.requestedDate).toLocaleString("en-AU")}),t.address&&e.jsxs("div",{style:{color:"#666",fontSize:13},children:["📍 ",t.address]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{style:{color:"#22314a"},children:"Request Tentative Appointment"}),e.jsxs("form",{onSubmit:f,children:[e.jsx("input",{className:"calendar-input",type:"text",placeholder:"Appointment Title",value:s.title,onChange:t=>i({...s,title:t.target.value}),required:!0}),e.jsx("textarea",{className:"calendar-textarea",placeholder:"Description",value:s.description,onChange:t=>i({...s,description:t.target.value})}),e.jsx("input",{className:"calendar-input",type:"date",value:s.date,onChange:t=>i({...s,date:t.target.value}),required:!0}),e.jsx(x,{label:"Start Time",value:s.time,onChange:t=>i({...s,time:t})}),e.jsx(x,{label:"End Time",value:s.endTime,onChange:t=>i({...s,endTime:t})}),e.jsx(S,{label:"Address/Location",value:s.address,onChange:(t,a)=>i({...s,address:t,addressMeta:a}),placeholder:"Start typing an Australian address…",showTip:!1}),e.jsx("button",{className:"calendar-btn-main",type:"submit",style:{marginTop:12},children:"Submit Request"})]})]})]})]}):e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:700,margin:"0 auto"},children:[e.jsx("h2",{children:"🔒 Login required"}),e.jsx("p",{children:"Please log in to access your client portal."}),e.jsx("a",{href:"/login",className:"calendar-btn-main",children:"Go to Login"})]})};export{w as default};
