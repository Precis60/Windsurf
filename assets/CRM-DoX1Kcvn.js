import{j as e,a as w,c as u}from"./index-BcgkQial.js";import{b as o}from"./vendor-DR4o8xae.js";const q=()=>{const[f,C]=o.useState(!1),[S,P]=o.useState(!0),[j,p]=o.useState([]),[v,h]=o.useState(!1),[x,A]=o.useState(!1),[y,g]=o.useState(null),[E,d]=o.useState(!1),[N,m]=o.useState({type:"",text:""}),[s,n]=o.useState({companyName:"",firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""});o.useEffect(()=>{(()=>{const a=w.isAuthenticated();C(a),P(!1)})()},[]),o.useEffect(()=>{f&&(async()=>{try{const a=await u.getAll(),r=Array.isArray(a)?a:a.customers||[];p(r)}catch(a){console.error("Error loading customers:",a),p([])}})()},[f]);const $=async t=>{if(t&&t.preventDefault&&t.preventDefault(),m({type:"",text:""}),d(!0),!s.firstName.trim()){m({type:"error",text:"Please enter a first name."}),d(!1);return}if(!s.lastName.trim()){m({type:"error",text:"Please enter a last name."}),d(!1);return}if(!s.email.trim()){m({type:"error",text:"Please enter an email address."}),d(!1);return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email.trim())){m({type:"error",text:"Please enter a valid email address."}),d(!1);return}const r={firstName:s.firstName.trim(),lastName:s.lastName.trim(),email:s.email.trim(),phone:(s.phone||"").trim()||null,company:(s.companyName||"").trim()||null,address:`${s.address}, ${s.city}, ${s.state} ${s.zipCode}`.trim().replace(/^,\s*|,\s*$/g,"")||null};try{const i=await u.create(r);n({companyName:"",firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""}),h(!1);const l=await u.getAll(),c=Array.isArray(l)?l:l.customers||[];p(c),m({type:"success",text:"Customer added successfully!"}),d(!1)}catch(i){let l="Failed to add customer. ";i.message.includes("Validation failed")?l+="Please check all required fields are filled correctly. Make sure you have entered both first and last name, and a valid email address.":i.message.includes("already exists")?l+="A customer with this email already exists.":l+=`Error: ${i.message}`,m({type:"error",text:l}),d(!1)}},k=async t=>{if(t.preventDefault(),console.log("Attempting to update customer with data:",s),!s.firstName.trim()){alert("Please enter a first name.");return}if(!s.lastName.trim()){alert("Please enter a last name.");return}if(!s.email.trim()){alert("Please enter an email address.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email.trim())){alert("Please enter a valid email address.");return}try{const r={firstName:s.firstName.trim(),lastName:s.lastName.trim(),email:s.email.trim(),phone:s.phone.trim()||null,company:s.companyName.trim()||null,address:`${s.address}, ${s.city}, ${s.state} ${s.zipCode}`.trim().replace(/^,\s*|,\s*$/g,"")||null};console.log("Sending updated customer data to backend:",r),await u.update(y,r),n({companyName:"",firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""}),g(null),h(!1);const i=await u.getAll(),l=Array.isArray(i)?i:i.customers||[];p(l),alert("Customer updated successfully!")}catch(r){console.error("Error updating customer:",r);let i="Failed to update customer. ";if(r.message.includes("Authentication required")){i+="Please log in again.",window.location.href="/login";return}else if(r.message.includes("Session expired")){i+="Your session has expired. Please log in again.",window.location.href="/login";return}else i+=`Error: ${r.message}`;alert(i)}},L=t=>{console.log("Editing customer:",t);let a="",r="",i="",l="";if(t.address){const c=t.address.split(", ");if(c.length>=1&&(a=c[0]||""),c.length>=2&&(r=c[1]||""),c.length>=3){const b=c[2].split(" ");i=b[0]||"",l=b[1]||""}}n({companyName:t.company||"",firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",phone:t.phone||"",address:a,city:r,state:i,zipCode:l,projectType:t.projectType||"",notes:t.notes||""}),g(t.id),h(!0)},M=async t=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await u.delete(t);const a=await u.getAll(),r=Array.isArray(a)?a:a.customers||[];p(r),alert("Customer deleted successfully!")}catch(a){console.error("Error deleting customer:",a);let r="Failed to delete customer. ";if(a.message.includes("Authentication required")){r+="Please log in again.",window.location.href="/login";return}else if(a.message.includes("Session expired")){r+="Your session has expired. Please log in again.",window.location.href="/login";return}else r+=`Error: ${a.message}`;alert(r)}};return S?e.jsx("div",{className:"crm-container",style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("h2",{children:"Loading CRM..."})}):f?e.jsxs("div",{className:"crm-container",children:[e.jsxs("div",{className:"crm-header",children:[e.jsx("h1",{className:"crm-title",children:"Customer Relationship Management"}),e.jsx("button",{className:"crm-logout-btn",onClick:()=>{w.logout(),C(!1),window.location.href="/"},children:"Logout"})]}),e.jsxs("div",{className:"crm-dashboard",children:[e.jsxs("div",{className:"crm-card",children:[e.jsx("h3",{children:"Customer Database"}),e.jsx("p",{children:"View and manage customer information, contact details, and project history."}),e.jsx("button",{className:"crm-btn-main",onClick:()=>{A(!x),h(!1),g(null)},children:x?"Hide Customers":"View Customers"}),e.jsx("button",{className:"crm-btn-secondary",onClick:()=>{h(!0),A(!1),g(null),n({companyName:"",firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",projectType:"",notes:""})},children:"Add Customer"})]}),e.jsxs("div",{className:"crm-card",children:[e.jsx("h3",{children:"Active Projects"}),e.jsxs("ul",{style:{listStyle:"none",padding:0},children:[e.jsx("li",{children:"Office Building Wiring - 75% Complete"}),e.jsx("li",{children:"Factory Automation - 40% Complete"}),e.jsx("li",{children:"Warehouse Network - Planning Phase"})]})]}),e.jsxs("div",{className:"crm-card",children:[e.jsx("h3",{children:"Recent Activity"}),e.jsxs("ul",{style:{listStyle:"none",padding:0},children:[e.jsx("li",{children:"New quote sent to ABC Corp"}),e.jsx("li",{children:"Project milestone reached"}),e.jsx("li",{children:"Customer feedback received"})]})]})]}),(v||x)&&e.jsxs("div",{className:"crm-section",children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem"},children:"ðŸ‘¥ Customer Management"}),v&&e.jsxs("div",{className:"crm-form",children:[e.jsx("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:y?"Edit Customer":"Add New Customer"}),e.jsxs("form",{onSubmit:y?k:$,noValidate:!0,children:[e.jsx("input",{type:"text",placeholder:"Company Name",value:s.companyName,onChange:t=>n({...s,companyName:t.target.value})}),e.jsx("input",{type:"text",placeholder:"First Name",value:s.firstName,onChange:t=>n({...s,firstName:t.target.value}),required:!0}),e.jsx("input",{type:"text",placeholder:"Last Name",value:s.lastName,onChange:t=>n({...s,lastName:t.target.value}),required:!0}),e.jsx("input",{type:"email",placeholder:"Email Address",value:s.email,onChange:t=>n({...s,email:t.target.value}),required:!0}),e.jsx("input",{type:"tel",placeholder:"Phone Number",value:s.phone,onChange:t=>n({...s,phone:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Street Address",value:s.address,onChange:t=>n({...s,address:t.target.value})}),e.jsx("input",{type:"text",placeholder:"City",value:s.city,onChange:t=>n({...s,city:t.target.value})}),e.jsx("input",{type:"text",placeholder:"State",value:s.state,onChange:t=>n({...s,state:t.target.value})}),e.jsx("input",{type:"text",placeholder:"ZIP Code",value:s.zipCode,onChange:t=>n({...s,zipCode:t.target.value})}),e.jsxs("select",{value:s.projectType,onChange:t=>n({...s,projectType:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Project Type"}),e.jsx("option",{value:"Network Infrastructure",children:"Network Infrastructure"}),e.jsx("option",{value:"Cable Installation",children:"Cable Installation"}),e.jsx("option",{value:"Equipment Setup",children:"Equipment Setup"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"}),e.jsx("option",{value:"Consultation",children:"Consultation"}),e.jsx("option",{value:"System Integration",children:"System Integration"}),e.jsx("option",{value:"Upgrade",children:"Upgrade"}),e.jsx("option",{value:"Emergency Service",children:"Emergency Service"})]}),e.jsx("textarea",{placeholder:"Notes (optional)",value:s.notes,onChange:t=>n({...s,notes:t.target.value})}),N.text&&e.jsx("div",{className:`crm-feedback ${N.type}`,children:N.text}),e.jsxs("div",{className:"crm-form-actions",children:[e.jsx("button",{className:"crm-btn-main",type:"submit",disabled:E,children:y?"Update Customer":"Add Customer"}),e.jsx("button",{className:"crm-btn-secondary",type:"button",onClick:()=>{h(!1),g(null)},children:"Cancel"})]})]})]}),x&&e.jsxs("div",{children:[e.jsxs("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:["Customer Database (",j.length," customers)"]}),e.jsx("div",{className:"crm-customer-list",children:j.length===0?e.jsx("div",{className:"crm-card",style:{textAlign:"center",color:"#666"},children:e.jsx("p",{children:'No customers added yet. Click "Add Customer" to get started.'})}):j.map(t=>e.jsxs("div",{className:"crm-customer-card",children:[e.jsxs("h4",{children:[t.firstName," ",t.lastName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Company:"})," ",t.company]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",e.jsx("a",{href:`mailto:${t.email}`,style:{color:"#007bff",textDecoration:"none",marginLeft:"0.5rem"},children:t.email})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",e.jsx("a",{href:`tel:${t.phone}`,style:{color:"#007bff",textDecoration:"none",marginLeft:"0.5rem"},children:t.phone})]}),t.address&&e.jsxs("div",{children:[e.jsx("strong",{children:"Address:"})," ",t.address]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"1rem"},children:["Added: ",new Date(t.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"crm-customer-actions",children:[e.jsx("button",{className:"crm-btn-edit",onClick:()=>L(t),children:"Edit"}),e.jsx("button",{className:"crm-btn-delete",onClick:()=>M(t.id),children:"Delete"})]})]},t.id))})]})]})]}):e.jsx("div",{className:"crm-container",children:e.jsxs("div",{className:"crm-card",style:{maxWidth:500,margin:"3rem auto",textAlign:"center"},children:[e.jsx("h1",{className:"crm-title",children:"ðŸ”’ CRM Access Required"}),e.jsx("p",{style:{color:"#666",marginBottom:24},children:"Please log in to access the CRM system."}),e.jsx("a",{href:"/login",className:"crm-btn-main",children:"Go to Login Page"})]})})};export{q as default};
