import{j as e,a as q,b as C,c as _}from"./index-BrwF-OIQ.js";import{b as g}from"./vendor-DR4o8xae.js";const X=({value:M,onChange:y,label:P})=>{const[m,h]=g.useState("hour"),D=g.useRef(null),W=l=>{if(!l)return{hours:12,minutes:0};const[a,c]=l.split(":").map(Number);return{hours:a||12,minutes:c||0}},{hours:d,minutes:f}=W(M),L=d>12?d-12:d===0?12:d,S=L%12*30+f*.5-90,x=f*6-90,T=l=>{if(!D.current)return;const a=D.current.getBoundingClientRect(),c=a.left+a.width/2,j=a.top+a.height/2,N=l.clientX||l.touches&&l.touches[0]?.clientX,b=l.clientY||l.touches&&l.touches[0]?.clientY;if(!N||!b)return;const A=(Math.atan2(b-j,N-c)*180/Math.PI+90+360)%360;if(m==="hour"){const $=Math.round(A/30)%12,w=$===0?12:$,H=d>=12?w===12?12:w+12:w;y(`${H.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`),h("minute")}else if(m==="minute"){const $=Math.round(A/6)%60;y(`${d.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`)}},v=[];for(let l=1;l<=12;l++){const a=(l*30-90)*Math.PI/180,c=50+35*Math.cos(a),j=50+35*Math.sin(a),N=50+40*Math.cos(a),b=50+40*Math.sin(a),k=50+32*Math.cos(a),A=50+32*Math.sin(a);v.push(e.jsxs("g",{children:[e.jsx("line",{x1:c,y1:j,x2:N,y2:b,stroke:"#333",strokeWidth:"2"}),e.jsx("text",{x:k,y:A,textAnchor:"middle",dominantBaseline:"central",fontSize:"12",fill:"#333",children:l})]},l))}const p=[];for(let l=0;l<60;l+=5)if(l%15!==0){const a=(l*6-90)*Math.PI/180,c=50+37*Math.cos(a),j=50+37*Math.sin(a),N=50+40*Math.cos(a),b=50+40*Math.sin(a);p.push(e.jsx("line",{x1:c,y1:j,x2:N,y2:b,stroke:"#666",strokeWidth:"1"},l))}return e.jsxs("div",{style:{margin:"1rem 0"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:P}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("div",{style:{position:"relative"},children:e.jsxs("svg",{ref:D,width:"200",height:"200",viewBox:"0 0 100 100",onClick:T,style:{border:`3px solid ${m==="hour"?"#22314a":"#dc3545"}`,borderRadius:"50%",background:m==="hour"?"#f8f9ff":"#fff8f8",cursor:"pointer",userSelect:"none"},children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"white",stroke:"#22314a",strokeWidth:"1"}),v,p,e.jsx("line",{x1:"50",y1:"50",x2:50+25*Math.cos(S*Math.PI/180),y2:50+25*Math.sin(S*Math.PI/180),stroke:m==="hour"?"#22314a":"#aaa",strokeWidth:m==="hour"?"5":"3",strokeLinecap:"round",pointerEvents:"none"}),e.jsx("line",{x1:"50",y1:"50",x2:50+35*Math.cos(x*Math.PI/180),y2:50+35*Math.sin(x*Math.PI/180),stroke:m==="minute"?"#dc3545":"#aaa",strokeWidth:m==="minute"?"4":"2",strokeLinecap:"round",pointerEvents:"none"}),e.jsx("circle",{cx:"50",cy:"50",r:"3",fill:"#22314a",pointerEvents:"none"}),e.jsx("circle",{cx:50+25*Math.cos(S*Math.PI/180),cy:50+25*Math.sin(S*Math.PI/180),r:"4",fill:m==="hour"?"#22314a":"#aaa",pointerEvents:"none"}),e.jsx("circle",{cx:50+35*Math.cos(x*Math.PI/180),cy:50+35*Math.sin(x*Math.PI/180),r:"3",fill:m==="minute"?"#dc3545":"#aaa",pointerEvents:"none"})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{background:"#f8f9fa",border:"2px solid #22314a",borderRadius:"8px",padding:"1rem",textAlign:"center",minWidth:"120px"},children:[e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#22314a",fontFamily:"monospace"},children:[L.toString().padStart(2,"0"),":",f.toString().padStart(2,"0")]}),e.jsx("div",{style:{fontSize:"14px",color:"#666",marginTop:"0.25rem"},children:d>=12?"PM":"AM"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:()=>{const l=d>=12?d-12:d;y(`${l.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`)},style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:d<12?"#22314a":"white",color:d<12?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"AM"}),e.jsx("button",{type:"button",onClick:()=>{const l=d<12?d+12:d;y(`${l.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`)},style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:d>=12?"#22314a":"white",color:d>=12?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"PM"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:()=>h("hour"),style:{padding:"0.5rem 1rem",border:"2px solid #22314a",borderRadius:"4px",background:m==="hour"?"#22314a":"white",color:m==="hour"?"white":"#22314a",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Hours"}),e.jsx("button",{type:"button",onClick:()=>h("minute"),style:{padding:"0.5rem 1rem",border:"2px solid #dc3545",borderRadius:"4px",background:m==="minute"?"#dc3545":"white",color:m==="minute"?"white":"#dc3545",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Minutes"})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",maxWidth:"150px",lineHeight:"1.4",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:"bold",color:m==="hour"?"#22314a":"#dc3545"},children:m==="hour"?"Setting Hours":"Setting Minutes"}),e.jsxs("div",{children:["Click anywhere on the clock face to set the ",m==="hour"?"hour":"minute"]})]})]})]})]})},ee=({open:M,title:y,message:P,onConfirm:m,onCancel:h})=>M?e.jsx("div",{className:"custom-modal-overlay",children:e.jsxs("div",{className:"custom-modal",children:[e.jsx("h3",{className:"custom-modal-title",children:y}),e.jsx("div",{className:"custom-modal-message",children:P}),e.jsxs("div",{className:"custom-modal-actions",children:[e.jsx("button",{className:"custom-modal-btn confirm",onClick:m,children:"Yes, Delete"}),e.jsx("button",{className:"custom-modal-btn cancel",onClick:h,children:"Cancel"})]})]})}):null,ae=()=>{const[M,y]=g.useState(!1),[P,m]=g.useState(!0),[h,D]=g.useState("monthly"),[W,d]=g.useState([]),[f,L]=g.useState([]),[S,x]=g.useState(!1),[T,v]=g.useState(null),[p,l]=g.useState(new Date),[a,c]=g.useState({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),[j,N]=g.useState(""),[b,k]=g.useState(!1),A=f.filter(t=>`${t.firstName} ${t.lastName}`.toLowerCase().includes(j.toLowerCase())),$=["Site Survey","Network Installation","Cable Installation","Equipment Setup","Maintenance","Repair","Consultation","Training","Safety Inspection","Project Planning","Client Meeting ","Troubleshooting","Upgrade","Testing & Commissioning","Documentation","Emergency Call","Preventive Maintenance","System Integration","Quality Assurance","Follow-up"];g.useEffect(()=>{(()=>{const n=q.isAuthenticated();y(n),m(!1)})()},[]);const w=t=>{if(!t.appointmentDate)return t;const n=new Date(t.appointmentDate),r=n.getHours().toString().padStart(2,"0"),s=n.getMinutes().toString().padStart(2,"0"),i=`${r}:${s}`;let o=i;if(t.durationMinutes){const u=new Date(n.getTime()+t.durationMinutes*6e4),I=u.getHours().toString().padStart(2,"0"),F=u.getMinutes().toString().padStart(2,"0");o=`${I}:${F}`}return{...t,time:i,endTime:o,date:t.appointmentDate}};g.useEffect(()=>{M&&(async()=>{try{const n=await C.getAll(),r=Array.isArray(n)?n:n.appointments||[];console.log("Loaded raw appointments:",r);const s=r.map(w);console.log("Transformed appointments:",s),d(s);const i=await _.getAll(),o=Array.isArray(i)?i:i.customers||[];L(o)}catch(n){console.error("Error loading data:",n),d([]),L([])}})()},[M]);const H=async t=>{t.preventDefault(),console.log("Attempting to create appointment with data:",a);const n=O(a.time,a.endTime);if(isNaN(n)||n<15||n>480){alert("Duration must be between 15 and 480 minutes.");return}if(!a.customerId||isNaN(Number(a.customerId))||!Number.isInteger(Number(a.customerId))){alert("Please select a valid client from the dropdown.");return}const r={title:a.title,description:a.description||`Client: ${a.client}
Category: ${a.category}
Address: ${a.address}`,appointmentDate:`${a.date}T${a.time}:00.000Z`,durationMinutes:n,customerId:Number(a.customerId)};console.log("Appointment payload:",r),Object.keys(r).forEach(s=>{console.log(`${s}:`,r[s],"type:",typeof r[s])});try{const s=await C.create(r);console.log("Appointment created successfully:",s),c({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),x(!1);const i=await C.getAll(),u=(Array.isArray(i)?i:i.appointments||[]).map(w);d(u),alert("Appointment added successfully!")}catch(s){let i="Failed to add appointment. ";s.response&&s.response.data&&s.response.data.error?(typeof s.response.data.error=="string"?i+=s.response.data.error:s.response.data.error.message?i+=s.response.data.error.message:i+=JSON.stringify(s.response.data.error),s.response.data.error.details&&(i+=`
Details:`,s.response.data.error.details.forEach(o=>{i+=`
- ${o.path}: ${o.msg} (value: ${o.value})`}))):s.message&&(i+=s.message),alert(i)}},O=(t,n)=>{const[r,s]=t.split(":").map(Number),[i,o]=n.split(":").map(Number),u=r*60+s;return i*60+o-u},V=async t=>{t.preventDefault();try{await C.update(T,a),c({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""}),v(null),x(!1);const n=await C.getAll(),s=(Array.isArray(n)?n:n.appointments||[]).map(w);d(s)}catch(n){console.error("Error updating appointment:",n),alert("Failed to update appointment. Please try again.")}},[z,B]=g.useState({open:!1,id:null}),G=async()=>{const t=z.id;B({open:!1,id:null});try{await C.delete(t);const n=await C.getAll(),s=(Array.isArray(n)?n:n.appointments||[]).map(w);d(s)}catch(n){console.error("Error deleting appointment:",n),alert("Failed to delete appointment. Please try again.")}},R=t=>{const n=t.toISOString().split("T")[0];console.log("Looking for appointments on date:",n),console.log("All appointments:",W);const r=W.filter(s=>{const i=s.appointmentDate||s.date;if(console.log("Checking appointment:",s.id,"appointmentDate:",i),!i)return console.log("No appointment date found for appointment:",s),!1;const o=i.split("T")[0],u=o===n;return console.log("Date comparison:",o,"vs",n,"=",u),u});return console.log("Filtered appointments for",n,":",r),r},J=()=>{const t=p.getFullYear(),n=p.getMonth(),r=new Date(t,n,1),s=new Date(r);s.setDate(s.getDate()-r.getDay());const i=[];for(let o=0;o<42;o++){const u=new Date(s);u.setDate(s.getDate()+o),i.push(u)}return i},Q=()=>{const t=new Date(p);t.setDate(p.getDate()-p.getDay());const n=[];for(let r=0;r<7;r++){const s=new Date(t);s.setDate(t.getDate()+r),n.push(s)}return n},U=t=>{const n=new Date(p);switch(h){case"monthly":n.setMonth(p.getMonth()+t);break;case"weekly":n.setDate(p.getDate()+t*7);break;case"daily":n.setDate(p.getDate()+t);break}l(n)},E=()=>{const t=[];for(let n=0;n<24;n++)for(let r=0;r<60;r+=15){const s=`${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;t.push(s)}return t};return P?e.jsx("div",{className:"calendar-container",style:{minHeight:"60vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("h2",{children:"Loading Calendar..."})}):M?e.jsxs("div",{className:"calendar-container",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("h1",{className:"calendar-title",children:"Calendar Management"}),e.jsx("button",{className:"calendar-logout-btn",onClick:()=>{q.logout(),y(!1),window.location.href="/"},children:"Logout"})]}),e.jsx("div",{className:"calendar-dashboard",children:e.jsxs("div",{className:"calendar-card",children:[e.jsx("h3",{children:"Appointment Management"}),e.jsx("p",{children:"View and manage appointments, clients, and schedules."}),e.jsx("button",{className:"calendar-btn-main",onClick:()=>{x(!S),v(null),c({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""})},children:S?"Cancel":"Add New Appointment"})]})}),S&&e.jsxs("div",{className:"calendar-section",children:[e.jsx("h2",{style:{color:"#22314a",marginBottom:"1.5rem"},children:T?"Edit Appointment":"Add New Appointment"}),e.jsxs("form",{className:"calendar-form",onSubmit:t=>{if(t.preventDefault(),!a.customerId){alert("Please select a valid client from the dropdown.");return}(T?V:H)(t)},noValidate:!0,children:[e.jsx("input",{type:"text",placeholder:"Appointment Title",value:a.title,onChange:t=>c({...a,title:t.target.value}),required:!0,className:"calendar-input"}),e.jsxs("div",{className:"calendar-client-select",children:[e.jsx("input",{type:"text",placeholder:"Select Client",value:j||a.client,onChange:t=>{N(t.target.value),k(!0),c({...a,client:t.target.value,customerId:""})},onBlur:()=>{setTimeout(()=>k(!1),200),f.find(n=>`${n.firstName} ${n.lastName}`.toLowerCase()===j.toLowerCase())||c(n=>({...n,customerId:""}))},onFocus:()=>k(!0),autoComplete:"off",required:!0,className:"calendar-input"}),b&&A.length>0&&e.jsx("div",{className:"calendar-client-dropdown",children:A.map(t=>e.jsxs("div",{className:"calendar-client-option",onClick:()=>{c({...a,client:`${t.firstName} ${t.lastName}`,customerId:t.id}),N(`${t.firstName} ${t.lastName}`),k(!1)},children:[t.firstName," ",t.lastName," ",t.company?`(${t.company})`:""]},t.id))})]}),e.jsx("input",{type:"date",value:a.date,onChange:t=>c({...a,date:t.target.value}),required:!0,className:"calendar-input"}),e.jsx(X,{label:"Start Time",value:a.time,onChange:t=>c({...a,time:t})}),e.jsx(X,{label:"End Time",value:a.endTime,onChange:t=>c({...a,endTime:t})}),e.jsxs("select",{value:a.category,onChange:t=>c({...a,category:t.target.value}),required:!0,className:"calendar-select",children:[e.jsx("option",{value:"",children:"Select Category"}),$.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",placeholder:"Address/Location",value:a.address,onChange:t=>c({...a,address:t.target.value}),className:"calendar-input"}),e.jsx("textarea",{placeholder:"Description",value:a.description,onChange:t=>c({...a,description:t.target.value}),className:"calendar-textarea"}),e.jsxs("div",{className:"calendar-form-actions",children:[e.jsx("button",{className:"calendar-btn-main",type:"submit",children:T?"Update Appointment":"Add Appointment"}),e.jsx("button",{className:"calendar-btn-secondary",type:"button",onClick:()=>{x(!1),v(null)},children:"Cancel"})]})]})]}),e.jsxs("div",{className:"calendar-section",children:[e.jsxs("div",{className:"calendar-nav-header",children:[e.jsx("button",{onClick:()=>U(-1),className:"calendar-nav-btn",children:"‹ Previous"}),e.jsxs("h3",{className:"calendar-nav-title",children:[h==="monthly"&&p.toLocaleDateString("en-US",{month:"long",year:"numeric"}),h==="weekly"&&`Week of ${p.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,h==="daily"&&p.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})]}),e.jsx("button",{onClick:()=>U(1),className:"calendar-nav-btn",children:"Next ›"}),e.jsxs("div",{className:"calendar-view-switcher",children:[e.jsx("button",{className:`calendar-view-btn${h==="monthly"?" active":""}`,onClick:()=>D("monthly"),type:"button",children:"Monthly"}),e.jsx("button",{className:`calendar-view-btn${h==="weekly"?" active":""}`,onClick:()=>D("weekly"),type:"button",children:"Weekly"}),e.jsx("button",{className:`calendar-view-btn${h==="daily"?" active":""}`,onClick:()=>D("daily"),type:"button",children:"Daily"})]})]}),h==="monthly"&&e.jsx("div",{className:"calendar-monthly-grid",children:J().map((t,n)=>{const r=R(t),s=t.getMonth()===p.getMonth(),i=t.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`calendar-day ${s?"":"calendar-day-muted"} ${i?"calendar-day-today":""}`,children:[e.jsx("div",{className:"calendar-day-date",children:t.getDate()}),r.filter(o=>{const u=o.time&&o.endTime&&String(o.time).trim()&&String(o.endTime).trim();return console.log("Appointment filter check:",o.id,"hasTime:",u,"time:",o.time,"endTime:",o.endTime),u}).map(o=>e.jsxs("div",{className:"calendar-appointment",onClick:()=>{c(o),v(o.id),x(!0)},children:[e.jsxs("div",{className:"calendar-appointment-time",children:[o.time," - ",o.endTime]}),e.jsx("div",{className:"calendar-appointment-title",children:o.title})]},o.id))]},n)})}),h==="weekly"&&e.jsxs("div",{className:"calendar-weekly-grid",children:[e.jsxs("div",{className:"calendar-time-slots",children:[e.jsx("div",{className:"calendar-time-slot-header"}),E().map((t,n)=>e.jsx("div",{className:"calendar-time-slot",children:n%4===0?t:""},t))]}),e.jsx("div",{className:"calendar-days-grid",children:Q().map((t,n)=>{const r=R(t),s=t.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`calendar-day ${s?"calendar-day-today":""}`,children:[e.jsx("div",{className:"calendar-day-header",children:t.toLocaleDateString("en-US",{weekday:"short",month:"numeric",day:"numeric"})}),e.jsxs("div",{className:"calendar-day-body",children:[E().map((i,o)=>e.jsx("div",{className:"calendar-time-slot"},i)),r.filter(i=>{const o=i.time&&i.endTime&&String(i.time).trim()&&String(i.endTime).trim();return console.log("Weekly view appointment filter:",i.id,"hasTime:",o,"time:",i.time,"endTime:",i.endTime),o}).map(i=>{const[o,u]=i.time.split(":").map(Number),[I,F]=i.endTime.split(":").map(Number),Y=(o*60+u)/15*15,Z=(I*60+F)/15*15,K=Math.max(30,Z-Y);return e.jsxs("div",{className:"calendar-appointment",style:{top:`${Y}px`,height:`${K}px`},onClick:()=>{c(i),v(i.id),x(!0)},children:[e.jsxs("div",{className:"calendar-appointment-time",children:[i.time," - ",i.endTime]}),e.jsx("div",{className:"calendar-appointment-title",children:i.title})]},i.id)})]})]},n)})})]}),h==="daily"&&e.jsxs("div",{className:"calendar-daily-grid",children:[e.jsxs("div",{className:"calendar-time-slots",children:[e.jsx("div",{className:"calendar-time-slot-header"}),E().map((t,n)=>e.jsx("div",{className:"calendar-time-slot",children:n%4===0?t:""},t))]}),e.jsxs("div",{className:"calendar-single-day",children:[e.jsx("div",{className:"calendar-day-header",children:p.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsxs("div",{className:"calendar-day-body",children:[E().map((t,n)=>e.jsx("div",{className:"calendar-time-slot"},t)),R(p).filter(t=>{const n=t.time&&t.endTime&&String(t.time).trim()&&String(t.endTime).trim();return console.log("Daily view appointment filter:",t.id,"hasTime:",n,"time:",t.time,"endTime:",t.endTime),n}).map(t=>{const[n,r]=t.time.split(":").map(Number),[s,i]=t.endTime.split(":").map(Number),o=(n*60+r)/15*15,u=(s*60+i)/15*15,I=Math.max(30,u-o);return e.jsxs("div",{className:"calendar-appointment",style:{top:`${o}px`,height:`${I}px`},onClick:()=>{c(t),v(t.id),x(!0)},children:[e.jsxs("div",{className:"calendar-appointment-time",children:[t.time," - ",t.endTime]}),e.jsx("div",{className:"calendar-appointment-title",children:t.title}),e.jsx("div",{className:"calendar-appointment-category",children:t.category})]},t.id)})]})]})]})]}),e.jsx(ee,{open:z.open,title:"Delete Appointment",message:"Are you sure you want to delete this appointment? This action cannot be undone.",onConfirm:G,onCancel:()=>B({open:!1,id:null})})]}):e.jsx("div",{className:"calendar-container",children:e.jsxs("div",{className:"calendar-card",style:{maxWidth:500,margin:"3rem auto",textAlign:"center"},children:[e.jsx("h1",{className:"calendar-title",children:"🔒 Calendar Access Required"}),e.jsx("p",{style:{color:"#666",marginBottom:24},children:"Please log in to access the calendar system."}),e.jsx("a",{href:"/login",className:"calendar-btn-main",children:"Go to Login Page"})]})})};export{ae as default};
