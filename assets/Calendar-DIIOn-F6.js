import{j as e,a as R,b as g,c as V}from"./index-Bj5Wwbly.js";import{b as c}from"./vendor-DR4o8xae.js";const Q=()=>{const[v,k]=c.useState(!1),[B,I]=c.useState(!0),[p,w]=c.useState("monthly"),[L,x]=c.useState([]),[O,C]=c.useState([]),[S,h]=c.useState(!1),[y,f]=c.useState(null),[d,P]=c.useState(new Date),[o,l]=c.useState({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),$=["Site Survey","Network Installation","Cable Installation","Equipment Setup","Maintenance","Repair","Consultation","Training","Safety Inspection","Project Planning","Client Meeting ","Troubleshooting","Upgrade","Testing & Commissioning","Documentation","Emergency Call","Preventive Maintenance","System Integration","Quality Assurance","Follow-up"];c.useEffect(()=>{(()=>{const n=R.isAuthenticated();k(n),I(!1)})()},[]),c.useEffect(()=>{v&&(async()=>{try{const n=await g.getAll(),r=Array.isArray(n)?n:n.appointments||[];x(r);const i=await V.getAll(),a=Array.isArray(i)?i:i.customers||[];C(a)}catch(n){console.error("Error loading data:",n),x([]),C([])}})()},[v]);const E=async t=>{t.preventDefault(),console.log("Attempting to create appointment with data:",o);try{const n={title:o.title,description:o.description||`Client: ${o.client}
Category: ${o.category}
Address: ${o.address}`,appointmentDate:`${o.date}T${o.time}:00.000Z`,durationMinutes:W(o.time,o.endTime),customerId:o.customerId||null};console.log("Sending appointment data to backend:",n);const r=await g.create(n);console.log("Appointment created successfully:",r),l({title:"",date:"",time:"",endTime:"",client:"",customerId:"",description:"",category:"",address:""}),h(!1);const i=await g.getAll(),a=Array.isArray(i)?i:i.appointments||[];x(a),alert("Appointment added successfully!")}catch(n){console.error("Detailed error adding appointment:",n),console.error("Error message:",n.message),console.error("Error stack:",n.stack);let r="Failed to add appointment. ";n.message.includes("Authentication required")?(r+="Please log in again.",window.location.href="/login"):n.message.includes("Session expired")?(r+="Your session has expired. Please log in again.",window.location.href="/login"):r+=`Error: ${n.message}`,alert(r)}},W=(t,n)=>{const[r,i]=t.split(":").map(Number),[a,s]=n.split(":").map(Number),u=r*60+i;return a*60+s-u},N=async t=>{t.preventDefault();try{await g.update(y,o),l({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""}),f(null),h(!1);const n=await g.getAll(),r=Array.isArray(n)?n:n.appointments||[];x(r)}catch(n){console.error("Error updating appointment:",n),alert("Failed to update appointment. Please try again.")}},z=async t=>{if(window.confirm("Are you sure you want to delete this appointment?"))try{await g.delete(t);const n=await g.getAll(),r=Array.isArray(n)?n:n.appointments||[];x(r)}catch(n){console.error("Error deleting appointment:",n),alert("Failed to delete appointment. Please try again.")}},A=t=>{const n=t.toISOString().split("T")[0];return L.filter(r=>r.date===n)},q=()=>{const t=d.getFullYear(),n=d.getMonth(),r=new Date(t,n,1),i=new Date(r);i.setDate(i.getDate()-r.getDay());const a=[];for(let s=0;s<42;s++){const u=new Date(i);u.setDate(i.getDate()+s),a.push(u)}return a},F=()=>{const t=new Date(d);t.setDate(d.getDate()-d.getDay());const n=[];for(let r=0;r<7;r++){const i=new Date(t);i.setDate(t.getDate()+r),n.push(i)}return n},T=t=>{const n=new Date(d);switch(p){case"monthly":n.setMonth(d.getMonth()+t);break;case"weekly":n.setDate(d.getDate()+t*7);break;case"daily":n.setDate(d.getDate()+t);break}P(n)},b=()=>{const t=[];for(let n=0;n<24;n++)for(let r=0;r<60;r+=15){const i=`${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`;t.push(i)}return t},m={background:"#22314a",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"4px",cursor:"pointer",margin:"0 0.5rem"},D={...m,background:"#1a2538"};return B?e.jsx("div",{className:"page-content",style:{padding:"2rem",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:e.jsxs("div",{style:{textAlign:"center",color:"#666"},children:[e.jsx("h2",{children:"Loading Calendar..."}),e.jsx("p",{children:"Please wait while we load your calendar data."})]})}):v?e.jsxs("div",{className:"page-content",style:{padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h1",{style:{color:"#22314a",margin:0},children:"Calendar Management"}),e.jsx("button",{onClick:()=>{R.logout(),k(!1),window.location.href="/"},style:{...m,background:"#dc3545"},children:"Logout"})]}),e.jsx("p",{style:{marginBottom:"2rem",fontSize:"1.1rem"},children:"Manage appointments and view your schedule."}),e.jsxs("div",{style:{marginBottom:"2rem",textAlign:"center"},children:[e.jsx("button",{style:p==="monthly"?D:m,onClick:()=>w("monthly"),children:"Monthly View"}),e.jsx("button",{style:p==="weekly"?D:m,onClick:()=>w("weekly"),children:"Weekly View"}),e.jsx("button",{style:p==="daily"?D:m,onClick:()=>w("daily"),children:"Daily View"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"2rem"},children:e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef",width:"100%",maxWidth:"600px"},children:[e.jsx("h3",{style:{color:"#22314a",marginBottom:"1rem"},children:"Appointment Management"}),e.jsx("button",{style:m,onClick:()=>{h(!S),f(null),l({title:"",date:"",time:"",endTime:"",client:"",description:"",category:"",address:""})},children:S?"Cancel":"Add New Appointment"}),S&&e.jsxs("form",{onSubmit:y?N:E,style:{marginTop:"1rem"},children:[e.jsx("input",{type:"text",placeholder:"Appointment Title",value:o.title,onChange:t=>l({...o,title:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"text",placeholder:"Client Name",value:o.client,onChange:t=>l({...o,client:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"date",value:o.date,onChange:t=>l({...o,date:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"time",placeholder:"Start Time",value:o.time,onChange:t=>l({...o,time:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("input",{type:"time",placeholder:"End Time",value:o.endTime,onChange:t=>l({...o,endTime:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsxs("select",{value:o.category,onChange:t=>l({...o,category:t.target.value}),required:!0,style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"},children:[e.jsx("option",{value:"",children:"Select Category"}),$.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",placeholder:"Address/Location",value:o.address,onChange:t=>l({...o,address:t.target.value}),style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc"}}),e.jsx("textarea",{placeholder:"Description",value:o.description,onChange:t=>l({...o,description:t.target.value}),style:{width:"100%",padding:"0.5rem",margin:"0.25rem 0",borderRadius:"4px",border:"1px solid #ccc",minHeight:"60px"}}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{type:"submit",style:{...m,flex:1},children:y?"Update Appointment":"Add Appointment"}),y&&e.jsx("button",{type:"button",onClick:()=>{window.confirm("Are you sure you want to delete this appointment?")&&z(y)},style:{...m,background:"#dc3545",flex:1},children:"Delete Appointment"})]})]})]})}),e.jsxs("div",{style:{background:"#f8f9fa",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e9ecef"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("button",{onClick:()=>T(-1),style:m,children:"‚Äπ Previous"}),e.jsxs("h3",{style:{color:"#22314a",margin:0},children:[p==="monthly"&&d.toLocaleDateString("en-US",{month:"long",year:"numeric"}),p==="weekly"&&`Week of ${d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,p==="daily"&&d.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})]}),e.jsx("button",{onClick:()=>T(1),style:m,children:"Next ‚Ä∫"})]}),p==="monthly"&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"1px"},children:q().map((t,n)=>{const r=A(t),i=t.getMonth()===d.getMonth(),a=t.toDateString()===new Date().toDateString();return e.jsxs("div",{style:{minHeight:"100px",padding:"0.25rem",background:i?"white":"#f8f9fa",border:a?"2px solid #22314a":"1px solid #dee2e6",opacity:i?1:.6},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.25rem"},children:t.getDate()}),r.map(s=>e.jsxs("div",{style:{background:"#e3f2fd",padding:"2px 4px",margin:"1px 0",borderRadius:"3px",fontSize:"0.7rem",cursor:"pointer",border:"1px solid #2196f3"},onClick:()=>{l(s),f(s.id),h(!0)},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[s.time," - ",s.endTime," ",s.title]}),e.jsx("div",{children:s.client})]},s.id))]},n)})}),p==="weekly"&&e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{width:"80px",borderRight:"1px solid #dee2e6"},children:[e.jsx("div",{style:{height:"40px",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"}}),b().map((t,n)=>e.jsx("div",{style:{height:"15px",fontSize:"0.7rem",padding:"0 0.25rem",borderBottom:n%4===3?"1px solid #ccc":"1px solid #f0f0f0",display:"flex",alignItems:"center",background:"#f8f9fa",justifyContent:"flex-end"},children:n%4===0?t:""},t))]}),e.jsx("div",{style:{flex:1,display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"1px"},children:F().map((t,n)=>{const r=A(t);return t.toDateString(),new Date().toDateString(),e.jsxs("div",{style:{background:"white",border:"1px solid #dee2e6",position:"relative"},children:[e.jsx("div",{style:{height:"40px",fontWeight:"bold",padding:"0.5rem",textAlign:"center",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"},children:t.toLocaleDateString("en-US",{weekday:"short",month:"numeric",day:"numeric"})}),e.jsxs("div",{style:{height:`${15*96}px`,position:"relative"},children:[b().map((i,a)=>e.jsx("div",{style:{height:"15px",borderBottom:a%4===3?"1px solid #ccc":"1px solid #f0f0f0"}},i)),r.map(i=>{const[a,s]=i.time.split(":").map(Number),[u,j]=i.endTime.split(":").map(Number),M=(a*60+s)/15*15,H=(u*60+j)/15*15,U=Math.max(30,H-M);return e.jsxs("div",{style:{position:"absolute",top:`${M}px`,left:"2px",right:"2px",height:`${U}px`,fontSize:"0.7rem",padding:"0.25rem",background:"#22314a",color:"white",borderRadius:"4px",cursor:"pointer",zIndex:1},onClick:()=>{l(i),f(i.id),h(!0)},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[i.time," - ",i.endTime," ",i.title]}),e.jsx("div",{children:i.client})]},i.id)})]})]},n)})})]}),p==="daily"&&e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{width:"80px",borderRight:"1px solid #dee2e6"},children:[e.jsx("div",{style:{height:"40px",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"}}),b().map((t,n)=>e.jsx("div",{style:{height:"15px",fontSize:"0.7rem",padding:"0 0.25rem",borderBottom:n%4===3?"1px solid #ccc":"1px solid #f0f0f0",display:"flex",alignItems:"center",background:"#f8f9fa",justifyContent:"flex-end"},children:n%4===0?t:""},t))]}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{background:"white",border:"1px solid #dee2e6",position:"relative"},children:[e.jsx("div",{style:{height:"40px",fontWeight:"bold",padding:"0.5rem",textAlign:"center",borderBottom:"1px solid #dee2e6",background:"#f8f9fa"},children:d.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsxs("div",{style:{height:`${15*96}px`,position:"relative"},children:[b().map((t,n)=>e.jsx("div",{style:{height:"15px",borderBottom:n%4===3?"1px solid #ccc":"1px solid #f0f0f0"}},t)),A(d).map(t=>{const[n,r]=t.time.split(":").map(Number),[i,a]=t.endTime.split(":").map(Number),s=(n*60+r)/15*15,u=(i*60+a)/15*15,j=Math.max(30,u-s);return e.jsxs("div",{style:{position:"absolute",top:`${s}px`,left:"2px",right:"2px",height:`${j}px`,fontSize:"0.8rem",padding:"0.5rem",background:"#22314a",color:"white",borderRadius:"4px",cursor:"pointer",zIndex:1},onClick:()=>{l(t),f(t.id),h(!0)},children:[e.jsxs("div",{style:{fontWeight:"bold"},children:[t.time," - ",t.endTime," ",t.title]}),e.jsx("div",{children:t.client}),e.jsx("div",{style:{fontSize:"0.7rem",marginTop:"0.25rem"},children:t.category})]},t.id)})]})]})})]})]})]}):e.jsx("div",{className:"page-content",style:{padding:"2rem",maxWidth:"600px",margin:"0 auto"},children:e.jsxs("div",{style:{background:"#f8f9fa",padding:"2rem",borderRadius:"8px",border:"1px solid #e9ecef",textAlign:"center"},children:[e.jsx("h1",{style:{color:"#22314a",marginBottom:"1rem"},children:"üîí Calendar Access Required"}),e.jsx("p",{style:{marginBottom:"2rem",fontSize:"1.1rem",color:"#666"},children:"Please log in to access the secure calendar management system."}),e.jsx("div",{style:{background:"#e8f5e8",border:"1px solid #4caf50",borderRadius:"8px",padding:"20px",marginBottom:"20px"},children:e.jsxs("p",{style:{margin:0,color:"#2e7d32",fontSize:"14px"},children:["üîê ",e.jsx("strong",{children:"Secure Access:"})," This calendar contains sensitive business information and requires authentication."]})}),e.jsx("a",{href:"/login",style:{background:"#22314a",color:"white",padding:"12px 24px",borderRadius:"8px",textDecoration:"none",fontSize:"16px",fontWeight:"500",display:"inline-block"},children:"Go to Login Page"})]})})};export{Q as default};
