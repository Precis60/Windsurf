import{j as e,a as p}from"./index-D0ys-dNt.js";import{b as i,u as C}from"./vendor-Dd4J3GVN.js";class T{constructor(){this.baseUrl="https://your-inception-controller-ip",this.username="",this.password="",this.sessionToken=null}async authenticate(){try{const s=await fetch(`${this.baseUrl}/api/v1/session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})});if(!s.ok)throw new Error("Authentication failed");const r=await s.json();return this.sessionToken=r.session_token,this.sessionToken}catch(s){throw console.error("Inception authentication error:",s),s}}async request(s,r={}){this.sessionToken||await this.authenticate();try{const a=await fetch(`${this.baseUrl}${s}`,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.sessionToken}`,...r.headers}});if(a.status===401)return await this.authenticate(),this.request(s,r);if(!a.ok)throw new Error(`API request failed: ${a.statusText}`);return await a.json()}catch(a){throw console.error("Inception API request error:",a),a}}async getAreas(){return await this.request("/api/v1/areas")}async getAreaStatus(s){return await this.request(`/api/v1/areas/${s}`)}async armArea(s,r="away",a=null){const t={mode:r};return a&&(t.user_code=a),await this.request(`/api/v1/areas/${s}/arm`,{method:"POST",body:JSON.stringify(t)})}async disarmArea(s,r){return await this.request(`/api/v1/areas/${s}/disarm`,{method:"POST",body:JSON.stringify({user_code:r})})}async getArmStatus(s){return(await this.getAreaStatus(s)).arm_state||"unknown"}async logout(){if(this.sessionToken){try{await this.request("/api/v1/session",{method:"DELETE"})}catch(s){console.error("Logout error:",s)}this.sessionToken=null}}}const v=new T,o=({areaId:l=1,areaName:s="Main Area"})=>{const[r,a]=i.useState("unknown"),[t,y]=i.useState(!1),[d,c]=i.useState(null),[u,h]=i.useState(""),[m,x]=i.useState(!1),[g,j]=i.useState(null);i.useEffect(()=>{f();const n=setInterval(f,1e4);return()=>clearInterval(n)},[l]);const f=async()=>{try{const n=await v.getArmStatus(l);a(n),c(null)}catch(n){console.error("Failed to load status:",n),c("Failed to connect to security system")}},N=n=>{j({type:"arm",mode:n}),x(!0)},w=()=>{j({type:"disarm"}),x(!0)},A=async()=>{if(!u){c("Please enter your security code");return}y(!0),c(null);try{g.type==="arm"?(await v.armArea(l,g.mode,u),a("arming")):g.type==="disarm"&&(await v.disarmArea(l,u),a("disarming")),h(""),x(!1),j(null),setTimeout(f,2e3)}catch(n){console.error("Action failed:",n),c("Action failed. Check your code and try again.")}finally{y(!1)}},S=()=>{h(""),x(!1),j(null),c(null)},b=()=>{switch(r){case"armed":case"armed_away":return"#dc3545";case"disarmed":return"#28a745";case"arming":case"disarming":return"#ffc107";case"alarm":return"#ff0000";default:return"#6c757d"}},k=()=>{switch(r){case"armed":case"armed_away":return"Armed";case"armed_stay":return"Armed (Stay)";case"armed_night":return"Armed (Night)";case"disarmed":return"Disarmed";case"arming":return"Arming...";case"disarming":return"Disarming...";case"alarm":return"ALARM!";default:return"Unknown"}};return e.jsxs("div",{className:"security-control",children:[e.jsxs("div",{className:"security-header",children:[e.jsx("h3",{children:s}),e.jsx("div",{className:"status-indicator",style:{backgroundColor:b()},children:k()})]}),d&&e.jsx("div",{className:"security-error",children:d}),m?e.jsxs("div",{className:"security-code-input",children:[e.jsx("h4",{children:"Enter Security Code"}),e.jsx("input",{type:"password",inputMode:"numeric",pattern:"[0-9]*",maxLength:"6",placeholder:"Enter code",value:u,onChange:n=>h(n.target.value),onKeyPress:n=>n.key==="Enter"&&A(),autoFocus:!0}),e.jsxs("div",{className:"code-buttons",children:[e.jsx("button",{className:"security-btn confirm",onClick:A,disabled:t||!u,children:t?"Processing...":"Confirm"}),e.jsx("button",{className:"security-btn cancel",onClick:S,disabled:t,children:"Cancel"})]})]}):e.jsxs("div",{className:"security-buttons",children:[(r==="disarmed"||r==="unknown")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"security-btn arm-away",onClick:()=>N("away"),disabled:t,children:"üè† Arm Away"}),e.jsx("button",{className:"security-btn arm-stay",onClick:()=>N("stay"),disabled:t,children:"üõãÔ∏è Arm Stay"}),e.jsx("button",{className:"security-btn arm-night",onClick:()=>N("night"),disabled:t,children:"üåô Arm Night"})]}),(r==="armed"||r==="armed_away"||r==="armed_stay"||r==="armed_night")&&e.jsx("button",{className:"security-btn disarm",onClick:w,disabled:t,children:"üîì Disarm"})]}),e.jsx("div",{className:"security-footer",children:e.jsxs("small",{children:["Last updated: ",new Date().toLocaleTimeString()]})})]})},L=()=>{const[l,s]=i.useState(!1),[r,a]=i.useState(!0),[t,y]=i.useState(null),d=C();i.useEffect(()=>{(()=>{const h=p.isAuthenticated(),m=p.getCurrentUser();if(!h){d("/login");return}if(m.role!=="admin"&&m.role!=="staff"){alert("Access denied. Security controls are only available to staff and administrators."),d("/");return}s(h),y(m),a(!1)})()},[d]);const c=()=>{p.logout(),d("/login")};return r?e.jsx("div",{className:"security-page",children:e.jsxs("div",{className:"security-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading security controls..."})]})}):l?e.jsxs("div",{className:"security-page",children:[e.jsxs("div",{className:"security-header-bar",children:[e.jsxs("div",{className:"security-title",children:[e.jsx("h1",{children:"üîí Security System Control"}),e.jsx("p",{children:"Manage alarm areas and security zones"})]}),e.jsxs("div",{className:"security-user-info",children:[e.jsxs("span",{className:"user-name",children:["üë§ ",t?.firstName," ",t?.lastName]}),e.jsx("span",{className:"user-role",children:t?.role}),e.jsx("button",{className:"logout-btn",onClick:c,children:"Logout"})]})]}),e.jsxs("div",{className:"security-info-banner",children:[e.jsx("div",{className:"info-icon",children:"‚ÑπÔ∏è"}),e.jsxs("div",{className:"info-content",children:[e.jsx("strong",{children:"Security Notice:"})," All arm/disarm actions are logged. You will need to enter your security code to perform any actions."]})]}),e.jsxs("div",{className:"security-grid",children:[e.jsxs("div",{className:"security-section",children:[e.jsx("h2",{children:"Main Building"}),e.jsxs("div",{className:"area-grid",children:[e.jsx(o,{areaId:1,areaName:"Reception"}),e.jsx(o,{areaId:2,areaName:"Office Floor 1"}),e.jsx(o,{areaId:3,areaName:"Office Floor 2"})]})]}),e.jsxs("div",{className:"security-section",children:[e.jsx("h2",{children:"Warehouse"}),e.jsxs("div",{className:"area-grid",children:[e.jsx(o,{areaId:4,areaName:"Warehouse Main"}),e.jsx(o,{areaId:5,areaName:"Loading Dock"}),e.jsx(o,{areaId:6,areaName:"Storage Area"})]})]}),e.jsxs("div",{className:"security-section",children:[e.jsx("h2",{children:"Perimeter"}),e.jsxs("div",{className:"area-grid",children:[e.jsx(o,{areaId:7,areaName:"Parking Lot"}),e.jsx(o,{areaId:8,areaName:"Exterior Gates"})]})]})]}),e.jsxs("div",{className:"security-footer-info",children:[e.jsxs("div",{className:"footer-section",children:[e.jsx("h3",{children:"Quick Guide"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Arm Away:"})," Full protection - all sensors active"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Arm Stay:"})," Perimeter only - motion sensors off"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Arm Night:"})," Night mode - selected sensors active"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Disarm:"})," Turn off all sensors"]})]})]}),e.jsxs("div",{className:"footer-section",children:[e.jsx("h3",{children:"Emergency Contacts"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Security Company:"})," 1300 XXX XXX"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Police:"})," 000"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Site Manager:"})," 0413 729 663"]})]})]})]})]}):null};export{L as default};
